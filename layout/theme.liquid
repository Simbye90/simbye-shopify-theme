<!doctype html>
<html lang="{{ request.locale.iso_code }}" dir="{% if request.locale.iso_code == 'ar' %}rtl{% else %}ltr{% endif %}">
<head>
  <!-- ========================================
       META TAGS & SEO (ENTERPRISE OPTIMIZED)
       ======================================== -->
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- ========================================
       INTELLIGENT ROBOTS META (SINGLE SOURCE OF TRUTH)
       ======================================== -->
  {% liquid
    assign noindex = false
    if request.page_type == 'search' or request.page_type == 'cart' or template contains 'customers' or request.path contains '/policies' or request.path contains '/account'
      assign noindex = true
    endif
  %}
  <meta name="robots" content="{% if noindex %}noindex, nofollow{% else %}index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1{% endif %}">
  <meta name="googlebot" content="{% if noindex %}noindex, nofollow{% else %}index, follow, max-snippet:-1, max-image-preview:large{% endif %}">
  <meta name="bingbot" content="{% if noindex %}noindex, nofollow{% else %}index, follow, max-snippet:-1, max-image-preview:large{% endif %}">
  
  <!-- Theme Color (Browser UI) -->
  <meta name="theme-color" content="#009a61" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#0a0a0a" media="(prefers-color-scheme: dark)">
  
  <!-- Google Site Verification -->
  <meta name="google-site-verification" content="7b_1zieYW2EKr0VNKoB_OvPsHTrpvjJ-MovSdnsfUZQ">
  <meta name="format-detection" content="telephone=no">
  
  <!-- Preconnect & DNS Prefetch -->
  <link rel="preconnect" href="https://cdn.shopify.com" crossorigin>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="dns-prefetch" href="//cdn.shopify.com">
  <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
  
  <!-- Preload Critical Resources -->
  <link rel="preload" as="image" href="https://cdn.shopify.com/s/files/1/0633/9012/2175/files/Simbye_Company_logo.webp?v=1739551616" type="image/webp">
  <link rel="preload" href="{{ 'critical.css' | asset_url }}" as="style">
  
  <!-- Critical CSS -->
  {{ 'critical.css' | asset_url | stylesheet_tag: preload: true }}
  
  <!-- Meta Tags Snippet (includes OG, Twitter, AI tags) -->
  {% render 'meta-tags' %}
  
  <!-- ========================================
       FAVICONS - HARDCODED (WORKS EVERYWHERE)
       ======================================== -->
  <link rel="icon" type="image/webp" sizes="192x192" href="https://cdn.shopify.com/s/files/1/0633/9012/2175/files/favicon-192.webp">
  <link rel="icon" type="image/png" sizes="32x32" href="https://cdn.shopify.com/s/files/1/0633/9012/2175/files/favicon-192.webp">
  <link rel="apple-touch-icon" sizes="180x180" href="https://cdn.shopify.com/s/files/1/0633/9012/2175/files/favicon-192.webp">
  <link rel="shortcut icon" href="https://cdn.shopify.com/s/files/1/0633/9012/2175/files/favicon-192.webp" type="image/x-icon">
  
  <!-- /index.html Redirect Fix -->
  {% if request.path == '/index.html' %}
    <meta http-equiv="refresh" content="0;url={{ shop.url }}/">
    <link rel="canonical" href="{{ shop.url }}/">
    <meta name="robots" content="noindex, follow">
    <script>window.location.replace('{{ shop.url }}/');</script>
  {% endif %}
  
  <!-- ========================================
       HREFLANG (SHOPIFY PRIMARY LOCALE FIX)
       Published Locales Only - Correct URL Construction
       ======================================== -->
  {% if shop.published_locales.size > 1 %}
    {% comment %}
      SHOPIFY PRIMARY LOCALE PROBLEM & SOLUTION:
      
      Shopify's Liquid has a design flaw:
      - Primary locale (English): locale.root_url = "/"
      - Other locales (German): locale.root_url = "/de"
      
      If we do: shop.url + locale.root_url + path
      - Primary: simbye.com + "/" + "/products/esim" = "simbye.com//products/esim" ❌
      - German: simbye.com + "/de" + "/products/esim" = "simbye.com/de/products/esim" ✅
      
      SOLUTION: Only add locale.root_url if locale is NOT primary
      Source: Shopify Community discussions on locale URL handling
    {% endcomment %}
    
    {% comment %} Step 1: Get path without current locale prefix {% endcomment %}
    {% assign base_path = request.path | remove_first: request.locale.root_url %}
    
    {% comment %} Step 2: Ensure base_path starts with "/" {% endcomment %}
    {% assign first_char = base_path | slice: 0 %}
    {% unless first_char == "/" %}
      {% assign base_path = "/" | append: base_path %}
    {% endunless %}
    
    {% comment %} Step 3: Generate hreflang for all published locales {% endcomment %}
    {% for locale in shop.published_locales %}
      <link rel="alternate" 
            hreflang="{{ locale.iso_code }}" 
            href="{{ shop.url }}{% unless locale.primary %}{{ locale.root_url }}{% endunless %}{{ base_path }}">
    {% endfor %}
    
    {% comment %} Step 4: x-default points to primary locale {% endcomment %}
    <link rel="alternate" 
          hreflang="x-default" 
          href="{{ shop.url }}{{ base_path }}">
  {% endif %}
  
  <!-- ========================================
       STRUCTURED DATA / SCHEMA.ORG
       ======================================== -->
  
  <!-- 1. Organization Schema (ALL PAGES) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Simbye",
    "url": "{{ shop.url }}",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cdn.shopify.com/s/files/1/0633/9012/2175/files/Simbye_Company_logo.webp"
    },
    "sameAs": [
      "https://www.facebook.com/profile.php?id=61557685794131",
      "https://www.instagram.com/simbyecom/",
      "https://www.tiktok.com/@simbye.com",
      "https://www.youtube.com/@Simbye.",
      "https://twitter.com/simbyecom"
    ],
    "contactPoint": {
      "@type": "ContactPoint",
      "telephone": "+19701028954",
      "contactType": "customer service",
      "areaServed": "Worldwide",
      "availableLanguage": ["English", "German", "French", "Spanish", "Polish", "Dutch", "Turkish", "Arabic"]
    }
  }
  </script>
  
  <!-- 2. WebSite Schema with Sitelinks SearchBox (ALL PAGES) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Simbye",
    "alternateName": "Simbye eSIM",
    "url": "{{ shop.url }}",
    "inLanguage": ["en", "de", "es", "fr", "tr", "nl", "pl", "ar"],
    "potentialAction": {
      "@type": "SearchAction",
      "target": {
        "@type": "EntryPoint",
        "urlTemplate": "{{ shop.url }}/search?q={search_term_string}"
      },
      "query-input": "required name=search_term_string"
    }
  }
  </script>
  
  <!-- 3. FAQ Schema (NON-PRODUCT PAGES ONLY) -->
  {% unless request.page_type == 'product' %}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "What is an eSIM?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "An eSIM (embedded SIM) is a digital SIM that allows you to activate a mobile plan without a physical SIM card. It's built into your device and can be activated instantly."
        }
      },
      {
        "@type": "Question",
        "name": "How do I activate my Simbye eSIM?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "After purchase, you'll receive a QR code via email. Simply scan it with your phone's camera, follow the prompts, and your eSIM will activate within minutes."
        }
      },
      {
        "@type": "Question",
        "name": "Can I use WhatsApp with Simbye eSIM?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes! WhatsApp is linked to your phone number, not your SIM card. You can use Simbye eSIM for data while keeping your original number for WhatsApp, calls and SMS."
        }
      },
      {
        "@type": "Question",
        "name": "How much does Simbye eSIM cost?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Plans start from 0 EUR. Prices vary by country and data amount. No contracts, no hidden fees. Pay only for what you need."
        }
      }
    ]
  }
  </script>
  {% endunless %}
  
  <!-- 4. Breadcrumbs Schema (EXCLUDE HOMEPAGE, CART, COLLECTION LIST) -->
  {% unless template == 'index' or template == 'cart' or template == 'list-collections' %}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "{{ shop.url }}"
      }
      {% if request.page_type == 'product' %}
      ,{
        "@type": "ListItem",
        "position": 2,
        "name": "Products",
        "item": "{{ shop.url }}/collections/all"
      },{
        "@type": "ListItem",
        "position": 3,
        "name": {{ product.title | escape | json }},
        "item": "{{ shop.url }}{{ product.url }}"
      }
      {% elsif request.page_type == 'collection' %}
      ,{
        "@type": "ListItem",
        "position": 2,
        "name": {{ collection.title | escape | json }},
        "item": "{{ shop.url }}{{ collection.url }}"
      }
      {% elsif request.page_type == 'page' %}
      ,{
        "@type": "ListItem",
        "position": 2,
        "name": {{ page.title | escape | json }},
        "item": "{{ shop.url }}{{ page.url }}"
      }
      {% elsif request.page_type == 'article' %}
      ,{
        "@type": "ListItem",
        "position": 2,
        "name": {{ blog.title | escape | json }},
        "item": "{{ shop.url }}{{ blog.url }}"
      },{
        "@type": "ListItem",
        "position": 3,
        "name": {{ article.title | escape | json }},
        "item": "{{ shop.url }}{{ article.url }}"
      }
      {% endif %}
    ]
  }
  </script>
  {% endunless %}
  
  <!-- 5. Product Schema (PRODUCT PAGES ONLY - OPTIMIZED FOR ZERO WARNINGS) -->
  {% if request.page_type == 'product' %}
  
  {% assign rating_value = product.metafields.custom.rating | replace: ',', '.' %}
  {% assign rating_count = product.metafields.custom.rating_count | plus: 0 %}
  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Product",
    "name": {{ product.title | strip | json }},
    "description": {{ product.description | strip_html | truncatewords: 50 | json }},
    "brand": {
      "@type": "Brand",
      "name": {{ product.vendor | default: 'Simbye' | json }}
    },
    "category": "Electronics > Communications > Mobile Phone Accessories > eSIM",
    {% if product.sku != blank %}
    "sku": {{ product.sku | json }},
    "productID": "{{ product.id }}",
    "mpn": {{ product.sku | json }},
    {% else %}
    "productID": "{{ product.id }}",
    {% endif %}
    "image": [
      {% for image in product.images limit: 5 %}
        {{ image | image_url: width: 1200 | json }}{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
    {% if product.variants.size > 1 %}
    ,"offers": [
      {% for variant in product.variants %}
      {
        "@type": "Offer",
        "name": {{ variant.title | json }},
        "sku": {{ variant.sku | default: variant.id | json }},
        "url": {{ shop.url | append: product.url | append: '?variant=' | append: variant.id | json }},
        "priceCurrency": {{ localization.country.currency.iso_code | default: shop.currency | json }},
        "price": {{ variant.price | divided_by: 100.0 | round: 2 }},
        "priceValidUntil": "{{ 'now' | date: '%Y' | plus: 1 }}-12-31",
        "itemCondition": "https://schema.org/NewCondition",
        "availability": "{% if variant.available %}https://schema.org/InStock{% else %}https://schema.org/OutOfStock{% endif %}",
        "shippingDetails": {
          "@type": "OfferShippingDetails",
          "shippingRate": {
            "@type": "MonetaryAmount",
            "value": "0",
            "currency": {{ localization.country.currency.iso_code | default: shop.currency | json }}
          },
          "shippingDestination": [
            {"@type": "DefinedRegion", "addressCountry": "DE"},
            {"@type": "DefinedRegion", "addressCountry": "AT"},
            {"@type": "DefinedRegion", "addressCountry": "CH"},
            {"@type": "DefinedRegion", "addressCountry": "US"},
            {"@type": "DefinedRegion", "addressCountry": "GB"},
            {"@type": "DefinedRegion", "addressCountry": "FR"},
            {"@type": "DefinedRegion", "addressCountry": "IT"},
            {"@type": "DefinedRegion", "addressCountry": "ES"},
            {"@type": "DefinedRegion", "addressCountry": "NL"},
            {"@type": "DefinedRegion", "addressCountry": "PL"},
            {"@type": "DefinedRegion", "addressCountry": "TR"}
          ],
          "deliveryTime": {
            "@type": "ShippingDeliveryTime",
            "handlingTime": {
              "@type": "QuantitativeValue",
              "minValue": 0,
              "maxValue": 0
            },
            "transitTime": {
              "@type": "QuantitativeValue",
              "minValue": 0,
              "maxValue": 0
            }
          }
        },
        "hasMerchantReturnPolicy": {
          "@type": "MerchantReturnPolicy",
          "applicableCountry": ["DE","AT","CH","US","GB","FR","IT","ES","NL","PL","TR"],
          "returnPolicyCategory": "https://schema.org/MerchantReturnFiniteReturnWindow",
          "merchantReturnDays": 30,
          "returnMethod": "https://schema.org/ReturnByMail",
          "returnFees": "https://schema.org/FreeReturn"
        }
      }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
    {% else %}
    ,"offers": {
      "@type": "Offer",
      "url": {{ shop.url | append: product.url | json }},
      "priceCurrency": {{ localization.country.currency.iso_code | default: shop.currency | json }},
      "price": {{ product.price | divided_by: 100.0 | round: 2 }},
      "priceValidUntil": "{{ 'now' | date: '%Y' | plus: 1 }}-12-31",
      "itemCondition": "https://schema.org/NewCondition",
      "availability": "{% if product.available %}https://schema.org/InStock{% else %}https://schema.org/OutOfStock{% endif %}",
      "shippingDetails": {
        "@type": "OfferShippingDetails",
        "shippingRate": {
          "@type": "MonetaryAmount",
          "value": "0",
          "currency": {{ localization.country.currency.iso_code | default: shop.currency | json }}
        },
        "shippingDestination": [
          {"@type": "DefinedRegion", "addressCountry": "DE"},
          {"@type": "DefinedRegion", "addressCountry": "AT"},
          {"@type": "DefinedRegion", "addressCountry": "CH"},
          {"@type": "DefinedRegion", "addressCountry": "US"},
          {"@type": "DefinedRegion", "addressCountry": "GB"},
          {"@type": "DefinedRegion", "addressCountry": "FR"},
          {"@type": "DefinedRegion", "addressCountry": "IT"},
          {"@type": "DefinedRegion", "addressCountry": "ES"},
          {"@type": "DefinedRegion", "addressCountry": "NL"},
          {"@type": "DefinedRegion", "addressCountry": "PL"},
          {"@type": "DefinedRegion", "addressCountry": "TR"}
        ],
        "deliveryTime": {
          "@type": "ShippingDeliveryTime",
          "handlingTime": {
            "@type": "QuantitativeValue",
            "minValue": 0,
            "maxValue": 0,
            "unitCode": "HUR"
          },
          "transitTime": {
            "@type": "QuantitativeValue",
            "minValue": 0,
            "maxValue": 0,
            "unitCode": "HUR"
          }
        }
      },
      "hasMerchantReturnPolicy": {
        "@type": "MerchantReturnPolicy",
        "applicableCountry": ["DE","AT","CH","US","GB","FR","IT","ES","NL","PL","TR"],
        "returnPolicyCategory": "https://schema.org/MerchantReturnFiniteReturnWindow",
        "merchantReturnDays": 30,
        "returnMethod": "https://schema.org/ReturnByMail",
        "returnFees": "https://schema.org/FreeReturn"
      }
    }
    {% endif %}
    ,"hasMerchantReturnPolicy": {
      "@type": "MerchantReturnPolicy",
      "applicableCountry": ["DE","AT","CH","US","GB","FR","IT","ES","NL","PL","TR"],
      "returnPolicyCategory": "https://schema.org/MerchantReturnFiniteReturnWindow",
      "merchantReturnDays": 30,
      "returnMethod": "https://schema.org/ReturnByMail",
      "returnFees": "https://schema.org/FreeReturn"
    }
    {% if rating_value and rating_count > 0 %}
    ,"aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": {{ rating_value }},
      "ratingCount": {{ rating_count }},
      "bestRating": 5,
      "worstRating": 1
    }
    {% endif %}
  }
  </script>
  {% endif %}
  
  <!-- ========================================
       SHOPIFY REQUIRED
       ======================================== -->
  {{ content_for_header }}
  
  <!-- ========================================
       CUSTOM STYLES
       ======================================== -->
  {% render 'css-variables' %}
  
  <!-- RTL Support Styles -->
  {% if request.locale.iso_code == 'ar' %}
  <style>
    body { direction: rtl; text-align: right; }
    .header-nav { flex-direction: row-reverse; }
    .footer-content { direction: rtl; }
    .nav-link::after { left: auto; right: 24px; }
  </style>
  {% endif %}
  
  <!-- jQuery 3.7.1 with SRI -->
  <script defer 
          src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
          integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
          crossorigin="anonymous"
          referrerpolicy="no-referrer"></script>
  
  <!-- Dark Mode Default Script (runs IMMEDIATELY) -->
  <script>
    (function() {
      var saved = null;
      try { saved = localStorage.getItem('theme'); } catch(e) {}
      var theme = saved || 'dark';
      document.documentElement.setAttribute('data-theme', theme);
      if (!saved) {
        try { localStorage.setItem('theme', 'dark'); } catch(e) {}
      }
    })();
  </script>
  
  <!-- Remove no-js class -->
  <script>
    document.documentElement.className = document.documentElement.className.replace('no-js', 'js');
  </script>
</head>

<body class="template-{{ request.page_type }}{% if request.locale.iso_code == 'ar' %} rtl-layout{% endif %}">
  
  <!-- Header Group -->
  {% sections 'header-group' %}
  
  <!-- Main Content -->
  <main id="MainContent" class="wrapper-body content-for-layout" role="main" tabindex="-1">
    {{ content_for_layout }}
  </main>
  
  <!-- Footer Group -->
  {% sections 'footer-group' %}
  
  <!-- Accessibility Helper -->
  <ul hidden>
    <li id="a11y-refresh-page-message">The page will refresh on selection</li>
  </ul>
  
  <!-- ========================================
       SCRIPTS (Deferred for Performance)
       ======================================== -->
  {% if template.directory == 'customers' %}
    <script defer src="{{ 'shopify_common.js' | shopify_asset_url }}"></script>
  {% endif %}
  
</body>
</html>