<style>
/* CSS Variables - OPTIMIZED */
:root {
  --header-height: 90px; /* +10px mehr Abstand */
  --header-mobile-height: 70px; /* +5px mehr */
  --primary-color: #009a61;
  --primary-hover: #00824f;
  --primary-accent: #00d97e;
  --text-color: #1a1a1a;
  --text-secondary: #666666;
  --bg-header: #ffffff;
  --border-color: rgba(0, 0, 0, 0.08);
  --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.06);
  --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.08);
  --shadow-lg: 0 12px 32px rgba(0, 154, 97, 0.15);
  --header-gradient: linear-gradient(135deg, #f8fffe 0%, #ffffff 100%);
  --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
  --transition-base: 250ms cubic-bezier(0.4, 0, 0.2, 1);
  --border-radius: 24px;
  --border-radius-sm: 16px;
}

/* Dark Mode */
[data-theme="dark"] {
  --text-color: #f5f5f5;
  --text-secondary: #999999;
  --bg-header: #0a0a0a;
  --border-color: rgba(255, 255, 255, 0.08);
  --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.3);
  --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.4);
  --shadow-lg: 0 12px 32px rgba(0, 217, 126, 0.15);
  --header-gradient: linear-gradient(135deg, rgba(0, 217, 126, 0.05) 0%, transparent 100%);
  --primary-accent: #00ff88;
}

/* Header - FIXED POSITION */
.enterprise-header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  width: 100vw;
  height: var(--header-height);
  background: var(--bg-header);
  z-index: 1000;
  transition: all var(--transition-base);
  border-bottom: 1px solid transparent;
}

/* Body Padding */
body { padding-top: var(--header-height); }
@media (max-width: 768px) { body { padding-top: var(--header-mobile-height); } }

.enterprise-header.scrolled {
  box-shadow: var(--shadow-md);
  border-bottom-color: var(--border-color);
  backdrop-filter: blur(10px);
}

[data-theme="dark"] .enterprise-header { background: #0a0a0a; }
[data-theme="dark"] .enterprise-header.scrolled { background: rgba(10, 10, 10, 0.95); }

.header-container {
  display: grid;
  grid-template-columns: 200px 1fr auto;
  align-items: center;
  height: 100%;
  max-width: 1600px;
  margin: 0 auto;
  padding: 0 40px;
  gap: 40px;
}

/* Logo */
.header-logo { display: flex; align-items: center; height: 100%; width: 200px; }
.header-logo img { width: 200px; height: auto; object-fit: contain; transition: transform var(--transition-fast); }
.header-logo:hover img { transform: scale(1.02); }

/* Desktop Navigation */
.header-nav { display: flex; align-items: center; gap: 8px; height: 100%; }
.nav-link {
  display: inline-flex; align-items: center; padding: 14px 26px; color: var(--text-color);
  font-size: 22px; font-weight: 600; text-decoration: none; border-radius: var(--border-radius-sm);
  transition: all var(--transition-fast); position: relative; overflow: hidden; letter-spacing: -0.01em;
}
.nav-link::before {
  content: ''; position: absolute; inset: 0;
  background: linear-gradient(135deg, rgba(0, 154, 97, 0.08), rgba(0, 217, 126, 0.08));
  opacity: 0; transition: opacity var(--transition-fast);
}
.nav-link:hover::before { opacity: 1; }
.nav-link:hover { color: var(--primary-color); transform: translateY(-1px); }
.nav-link::after {
  content: ''; position: absolute; bottom: 8px; left: 24px; right: 24px; height: 2px;
  background: linear-gradient(90deg, var(--primary-color), var(--primary-accent));
  transform: scaleX(0); transition: transform var(--transition-fast); border-radius: 1px;
}
.nav-link.active::after, .nav-link:hover::after { transform: scaleX(1); }

/* Desktop Actions */
.header-actions { display: flex; align-items: center; gap: 12px; height: 100%; }

/* Login Button */
.auth-btn {
  display: inline-flex; align-items: center; justify-content: center;
  padding: 0 28px; height: 44px; font-size: 15px; font-weight: 600; color: white;
  background: var(--primary-color); text-decoration: none; border-radius: 12px;
  transition: all var(--transition-fast); gap: 8px; box-shadow: 0 2px 8px rgba(0, 154, 97, 0.2);
  border: none; letter-spacing: -0.01em;
}
.auth-btn:hover { background: var(--primary-hover); transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0, 154, 97, 0.3); }
.auth-btn:active { transform: scale(0.98); }
.auth-btn svg { width: 18px; height: 18px; }

/* Switchers */
.switcher-group { display: flex; gap: 8px; }
.switcher {
  position: relative; display: flex; align-items: center; gap: 8px; padding: 10px 16px;
  border-radius: 12px; background: var(--header-gradient); border: 1px solid var(--border-color);
  color: var(--text-color); font-size: 14px; font-weight: 500; cursor: pointer;
  transition: all var(--transition-fast); box-shadow: var(--shadow-sm); user-select: none;
}
.switcher:hover { border-color: var(--primary-color); transform: translateY(-1px); box-shadow: var(--shadow-md); }
[data-theme="dark"] .switcher { background: rgba(26, 26, 26, 0.8); backdrop-filter: blur(10px); }

/* Dropdown Arrow */
.switcher::after {
  content: ''; width: 0; height: 0; border-left: 4px solid transparent; border-right: 4px solid transparent;
  border-top: 5px solid currentColor; opacity: 0.6; transition: transform var(--transition-fast);
}
.switcher.active::after { transform: rotate(180deg); }

/* Dropdown Menu */
.switcher-dropdown {
  position: absolute; top: calc(100% + 8px); left: 0; min-width: 220px; background: white;
  border: 1px solid var(--border-color); border-radius: 12px; box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
  opacity: 0; visibility: hidden; transform: translateY(-10px); transition: all var(--transition-fast);
  z-index: 1001; overflow: hidden;
}
[data-theme="dark"] .switcher-dropdown {
  background: #1a1a1a; border-color: rgba(255, 255, 255, 0.08); box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
}
.switcher.active .switcher-dropdown { opacity: 1; visibility: visible; transform: translateY(0); }

.dropdown-item {
  display: flex; align-items: center; gap: 10px; padding: 10px 16px; color: var(--text-color);
  text-decoration: none; font-size: 14px; transition: background var(--transition-fast); cursor: pointer;
  border: none; background: none; width: 100%; text-align: left; font-family: inherit;
}
.dropdown-item:hover { background: rgba(0, 154, 97, 0.08); }
.dropdown-item.active { background: rgba(0, 154, 97, 0.12); color: var(--primary-color); font-weight: 600; }

/* Dark Mode Toggle Desktop */
.theme-toggle {
  display: flex; align-items: center; justify-content: center; width: 44px; height: 44px;
  border-radius: 12px; background: var(--header-gradient); border: 1px solid var(--border-color);
  cursor: pointer; transition: all var(--transition-base); position: relative; overflow: hidden;
  box-shadow: var(--shadow-sm);
}
.theme-toggle:hover { border-color: var(--primary-color); transform: rotate(15deg) scale(1.05); box-shadow: var(--shadow-md); }
[data-theme="dark"] .theme-toggle { background: rgba(26, 26, 26, 0.8); backdrop-filter: blur(10px); }
.theme-toggle svg { width: 20px; height: 20px; transition: all var(--transition-base); position: absolute; color: var(--text-color); }
.theme-toggle .sun-icon { opacity: 0; transform: rotate(-180deg) scale(0); }
.theme-toggle .moon-icon { opacity: 1; transform: rotate(0) scale(1); }
[data-theme="dark"] .theme-toggle .sun-icon { opacity: 1; transform: rotate(0) scale(1); color: var(--primary-accent); }
[data-theme="dark"] .theme-toggle .moon-icon { opacity: 0; transform: rotate(180deg) scale(0); }

/* Mobile Toggle */
.mobile-toggle { display: none; width: 44px; height: 44px; align-items: center; justify-content: center; border-radius: 12px; background: var(--primary-color); cursor: pointer; border: none; position: relative; transition: all var(--transition-fast); }
.mobile-toggle:hover { background: var(--primary-hover); }
.mobile-toggle:active { transform: scale(0.95); }
.mobile-toggle .burger { width: 20px; height: 16px; position: relative; }
.mobile-toggle .burger span { display: block; position: absolute; width: 100%; height: 2px; background: white; border-radius: 2px; transition: all var(--transition-base); }
.mobile-toggle .burger span:nth-child(1) { top: 0; }
.mobile-toggle .burger span:nth-child(2) { top: 7px; }
.mobile-toggle .burger span:nth-child(3) { bottom: 0; }
.mobile-toggle.active .burger span:nth-child(1) { transform: rotate(45deg) translate(5px, 5px); }
.mobile-toggle.active .burger span:nth-child(2) { opacity: 0; transform: translateX(-10px); }
.mobile-toggle.active .burger span:nth-child(3) { transform: rotate(-45deg) translate(5px, -5px); }

/* Mobile Menu */
.mobile-menu { position: fixed; top: 0; right: 0; width: 75%; max-width: 360px; height: 100vh; background: var(--bg-header); transform: translateX(100%); transition: transform var(--transition-base); z-index: 1001; overflow-y: auto; box-shadow: -8px 0 32px rgba(0, 0, 0, 0.15); }
[data-theme="dark"] .mobile-menu { background: #0a0a0a; box-shadow: -8px 0 32px rgba(0, 0, 0, 0.5); }
.mobile-menu.active { transform: translateX(0); }

.mobile-overlay { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.6); opacity: 0; visibility: hidden; transition: all var(--transition-base); z-index: 1000; backdrop-filter: blur(4px); }
.mobile-overlay.active { opacity: 1; visibility: visible; }

/* Mobile Menu Header */
.mobile-menu-header { padding: 20px; border-bottom: 2px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; min-height: 70px; background: transparent; }
[data-theme="dark"] .mobile-menu-header { border-bottom-color: rgba(255, 255, 255, 0.08); }

.mobile-header-login {
  display: flex; align-items: center; gap: 8px; text-decoration: none; color: white; font-size: 15px; font-weight: 600; transition: all var(--transition-fast); padding: 10px 20px; border-radius: 12px; background: var(--primary-color); letter-spacing: -0.01em;
}
.mobile-header-login:hover { background: var(--primary-hover); transform: translateX(2px); }
.mobile-header-login svg { width: 18px; height: 18px; }

.mobile-close { width: 40px; height: 40px; border-radius: 12px; background: rgba(255, 255, 255, 0.1); border: 2px solid var(--border-color); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all var(--transition-fast); box-shadow: var(--shadow-sm); }
.mobile-close svg { color: #1a1a1a; width: 20px; height: 20px; }
[data-theme="dark"] .mobile-close { border-color: rgba(255, 255, 255, 0.15); background: rgba(255, 255, 255, 0.05); }
[data-theme="dark"] .mobile-close svg { color: #ffffff; }
.mobile-close:hover { background: rgba(255, 59, 48, 0.1); border-color: #ff3b30; transform: rotate(90deg); }
.mobile-close:hover svg { color: #ff3b30; }

/* Mobile Navigation */
.mobile-nav { padding: 20px; }
.mobile-nav-item {
  display: block; padding: 16px 20px; color: var(--text-color); font-size: 17px; font-weight: 600;
  text-decoration: none; border-radius: 12px; transition: all var(--transition-fast); margin-bottom: 8px;
  background: var(--header-gradient); border: 1px solid var(--border-color); letter-spacing: -0.01em;
}
[data-theme="dark"] .mobile-nav-item { background: rgba(26, 26, 26, 0.5); border-color: rgba(255, 255, 255, 0.08); }
.mobile-nav-item:hover, .mobile-nav-item:active { background: rgba(0, 154, 97, 0.1); border-color: var(--primary-color); transform: translateX(4px); color: var(--primary-color); }

/* Mobile Settings */
.mobile-settings { padding: 20px; border-top: 2px solid var(--border-color); display: flex; flex-direction: column; gap: 12px; background: var(--header-gradient); }
[data-theme="dark"] .mobile-settings { background: rgba(0, 217, 126, 0.02); border-top-color: rgba(255, 255, 255, 0.08); }

.settings-row { display: flex; align-items: center; justify-content: space-between; padding: 12px; border-radius: 12px; background: rgba(0, 0, 0, 0.02); position: relative; }
[data-theme="dark"] .settings-row { background: rgba(255, 255, 255, 0.03); }

.settings-label { font-size: 15px; font-weight: 600; color: var(--text-color); letter-spacing: -0.01em; }
.settings-value {
  display: flex; align-items: center; gap: 8px; padding: 8px 14px; border-radius: 10px; background: white; font-size: 14px; font-weight: 600; color: var(--text-color); box-shadow: var(--shadow-sm); border: 1px solid var(--border-color); cursor: pointer; transition: all var(--transition-fast);
}
.settings-value:hover { border-color: var(--primary-color); transform: translateX(2px); }
[data-theme="dark"] .settings-value { background: rgba(26, 26, 26, 0.8); border-color: rgba(255, 255, 255, 0.08); }

/* Mobile Dropdown */
.mobile-dropdown {
  position: absolute; bottom: calc(100% + 8px); right: 0; min-width: 220px; background: white; border: 1px solid var(--border-color);
  border-radius: 12px; box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12); opacity: 0; visibility: hidden; transform: translateY(10px);
  transition: all var(--transition-fast); z-index: 1002; overflow: hidden; max-height: 300px; overflow-y: auto;
}
[data-theme="dark"] .mobile-dropdown { background: #1a1a1a; border-color: rgba(255, 255, 255, 0.08); box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4); }
.settings-row.active .mobile-dropdown { opacity: 1; visibility: visible; transform: translateY(0); }
.mobile-dropdown-item {
  display: flex; align-items: center; gap: 10px; padding: 12px 16px; color: var(--text-color); text-decoration: none; font-size: 14px; transition: background var(--transition-fast); cursor: pointer; border: none; background: none; width: 100%; text-align: left; font-family: inherit; font-weight: 500;
}
.mobile-dropdown-item:hover { background: rgba(0, 154, 97, 0.08); }
.mobile-dropdown-item.active { background: rgba(0, 154, 97, 0.12); color: var(--primary-color); font-weight: 600; }

/* Dark Mode Switch */
.dark-mode-switch { position: relative; width: 48px; height: 26px; background: #e0e0e0; border-radius: 13px; cursor: pointer; transition: background var(--transition-fast); box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1); }
[data-theme="dark"] .dark-mode-switch { background: var(--primary-color); box-shadow: 0 4px 12px rgba(0, 217, 126, 0.3); }
.dark-mode-switch-handle { position: absolute; top: 3px; left: 3px; width: 20px; height: 20px; background: white; border-radius: 50%; transition: transform var(--transition-fast); box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2); }
[data-theme="dark"] .dark-mode-switch-handle { transform: translateX(22px); }

/* Mobile Footer */
.mobile-footer { padding: 20px; text-align: center; font-size: 12px; color: var(--text-secondary); opacity: 0.6; border-top: 1px solid var(--border-color); }

/* Responsive */
@media (max-width: 1200px) {
  .header-container { padding: 0 24px; }
  .nav-link { font-size: 17px; padding: 10px 20px; }
}
@media (max-width: 768px) {
  .enterprise-header { height: var(--header-mobile-height); width: 100vw; }
  .header-container { grid-template-columns: 160px 1fr; padding: 0 20px; gap: 12px; max-width: none; }
  .header-logo { width: 160px; }
  .header-logo img { width: 160px; max-width: 160px; }
  .header-nav, .switcher-group, .theme-toggle, .auth-btn { display: none; }
  .mobile-toggle { display: flex; }
  .header-actions { justify-content: flex-end; }
}

/* Scrollbar */
.mobile-menu::-webkit-scrollbar, .mobile-dropdown::-webkit-scrollbar { width: 6px; }
.mobile-menu::-webkit-scrollbar-track, .mobile-dropdown::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.05); border-radius: 3px; }
.mobile-menu::-webkit-scrollbar-thumb, .mobile-dropdown::-webkit-scrollbar-thumb { background: var(--primary-color); border-radius: 3px; }
[data-theme="dark"] .mobile-menu::-webkit-scrollbar-track, [data-theme="dark"] .mobile-dropdown::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); }
</style>

<header class="enterprise-header" id="enterprise-header">
  <div class="header-container">
    <!-- Logo -->
    <div class="header-logo">
      <a href="{{ routes.root_url }}">
        <img 
          src="https://cdn.shopify.com/s/files/1/0633/9012/2175/files/Simbye_Company_logo.webp?v=1739551616"
          alt="{{ shop.name }}"
          loading="eager"
        >
      </a>
    </div>
    
    <!-- Desktop Navigation (locale-aware via routes.root_url) -->
    <nav class="header-nav">
      <a href="{{ routes.root_url }}pages/how-it-works" class="nav-link">
        {{ 'header.how_esim_works' | t | default: 'How eSIM Works' }}
      </a>
      <a href="{{ routes.root_url }}pages/check-esim" class="nav-link">
        {{ 'header.check_esim' | t | default: 'Check eSIM' }}
      </a>
      <a href="{{ routes.root_url }}pages/faq" class="nav-link">
        {{ 'header.faq' | t | default: 'FAQ' }}
      </a>
      <a href="{{ routes.root_url }}pages/support" class="nav-link">
        {{ 'header.support' | t | default: 'Support' }}
      </a>
    </nav>
    
    <!-- Desktop Actions -->
    <div class="header-actions">
      <!-- Login -->
      {% if customer %}
        <a href="{{ routes.account_url }}" class="auth-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <circle cx="12" cy="8" r="4"/>
            <path d="M4 20c0-4.4 3.6-8 8-8s8 3.6 8 8"/>
          </svg>
          {{ customer.first_name | default: 'Account' }}
        </a>
      {% else %}
        <a href="{{ routes.account_login_url }}" class="auth-btn">
          {{ 'header.login' | t | default: 'Login' }}
        </a>
      {% endif %}
      
      <!-- Switchers -->
      <div class="switcher-group">
        <!-- Language Switcher -->
        <div class="switcher" id="language-switcher" aria-haspopup="true" aria-expanded="false">
          <span>🌐</span>
          <span id="current-locale">{{ localization.language.iso_code | upcase }}</span>
          
          <div class="switcher-dropdown" role="menu" aria-label="Languages">
            <localization-form>
              {% form 'localization' %}
                <input type="hidden" name="language_code" value="{{ localization.language.iso_code }}">
                <input type="hidden" name="return_to" value="{{ request.url }}">
                {% for language in localization.available_languages %}
                  <button type="submit"
                          class="dropdown-item {% if language.iso_code == localization.language.iso_code %}active{% endif %}"
                          data-value="{{ language.iso_code }}"
                          onclick="this.form.querySelector('[name=language_code]').value='{{ language.iso_code }}'">
                    <span>{{ language.endonym_name }}</span>
                  </button>
                {% endfor %}
              {% endform %}
            </localization-form>
          </div>
        </div>
        
        <!-- Currency/Country Switcher (NO DUPLICATES) -->
        <div class="switcher" id="country-switcher" aria-haspopup="true" aria-expanded="false">
          <span id="current-country">{{ localization.country.currency.symbol }} {{ localization.country.currency.iso_code }}</span>
          
          <div class="switcher-dropdown" role="menu" aria-label="Currencies">
            {% if localization.available_countries.size > 1 %}
              {% assign shown_currencies = '' %}
              <localization-form>
                {% form 'localization' %}
                  <input type="hidden" name="country_code" value="{{ localization.country.iso_code }}">
                  <input type="hidden" name="return_to" value="{{ request.url }}">
                  {% for country in localization.available_countries %}
                    {% assign currency_code = country.currency.iso_code %}
                    {% unless shown_currencies contains currency_code %}
                      {% assign shown_currencies = shown_currencies | append: currency_code | append: ',' %}
                      <button type="submit"
                              class="dropdown-item {% if country.iso_code == localization.country.iso_code %}active{% endif %}"
                              data-value="{{ country.iso_code }}"
                              onclick="this.form.querySelector('[name=country_code]').value='{{ country.iso_code }}'">
                        <span>{{ country.currency.symbol }} {{ country.currency.iso_code }}</span>
                      </button>
                    {% endunless %}
                  {% endfor %}
                {% endform %}
              </localization-form>
            {% endif %}
          </div>
        </div>
      </div>
      
      <!-- Dark Mode -->
      <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
        <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <circle cx="12" cy="12" r="5"/>
          <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
        </svg>
        <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>
      </button>
      
      <!-- Mobile Toggle -->
      <button class="mobile-toggle" id="mobile-toggle" aria-label="Toggle menu">
        <div class="burger">
          <span></span><span></span><span></span>
        </div>
      </button>
    </div>
  </div>
</header>

<!-- Mobile Menu -->
<div class="mobile-overlay" id="mobile-overlay" aria-hidden="true"></div>
<nav class="mobile-menu" id="mobile-menu" aria-hidden="true">
  <!-- Header -->
  <div class="mobile-menu-header">
    {% if customer %}
      <a href="{{ routes.account_url }}" class="mobile-header-login">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <circle cx="12" cy="8" r="4"/><path d="M4 20c0-4.4 3.6-8 8-8s8 3.6 8 8"/>
        </svg>
        <span>{{ customer.first_name | default: 'Account' }}</span>
      </a>
    {% else %}
      <a href="{{ routes.account_login_url }}" class="mobile-header-login">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <circle cx="12" cy="8" r="4"/><path d="M4 20c0-4.4 3.6-8 8-8s8 3.6 8 8"/>
        </svg>
        <span>{{ 'header.login' | t | default: 'Login' }}</span>
      </a>
    {% endif %}
    
    <button class="mobile-close" id="mobile-close" aria-label="Close menu">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <path d="M18 6L6 18M6 6l12 12"/>
      </svg>
    </button>
  </div>
  
  <!-- Navigation -->
  <nav class="mobile-nav">
    <a href="{{ routes.root_url }}pages/how-it-works" class="mobile-nav-item">
      {{ 'header.how_esim_works' | t | default: 'How eSIM Works' }}
    </a>
    <a href="{{ routes.root_url }}pages/check-esim" class="mobile-nav-item">
      {{ 'header.check_esim' | t | default: 'Check eSIM' }}
    </a>
    <a href="{{ routes.root_url }}pages/faq" class="mobile-nav-item">
      {{ 'header.faq' | t | default: 'FAQ' }}
    </a>
    <a href="{{ routes.root_url }}pages/support" class="mobile-nav-item">
      {{ 'header.support' | t | default: 'Support' }}
    </a>
  </nav>
  
  <!-- Settings -->
<!-- SWITCHER GROUP (Complex DIV Variante) -->
<div class="switcher-group" id="switcher-group">

  <!-- LANGUAGE SWITCHER -->
  <div class="switcher" id="language-switcher" aria-haspopup="true" aria-expanded="false">
    <span>🌐</span>
    <span id="current-locale">{{ localization.language.iso_code | upcase }}</span>

    <div class="switcher-dropdown" role="menu" aria-label="Languages">
      <localization-form>
        {% form 'localization', id: 'lang-form', action: routes.localization_url %}
          <!-- Rücksprungziel: auf Market-Root weiterleiten (empfohlen bei Domain/Subfolder-Wechsel) -->
          <input type="hidden" name="return_to" value="{{ routes.root_url }}">
          <input type="hidden" name="language_code" value="{{ localization.language.iso_code }}">
          {% for language in localization.available_languages %}
            <button type="button"
                    class="dropdown-item {% if language.iso_code == localization.language.iso_code %}active{% endif %}"
                    data-language="{{ language.iso_code }}"
                    aria-pressed="{% if language.iso_code == localization.language.iso_code %}true{% else %}false{% endif %}">
              <span>{{ language.endonym_name }}</span>
            </button>
          {% endfor %}
        {% endform %}
      </localization-form>
    </div>
  </div>

  <!-- CURRENCY/COUNTRY SWITCHER (ohne doppelte Währungen) -->
  <div class="switcher" id="country-switcher" aria-haspopup="true" aria-expanded="false">
    <span id="current-country">{{ localization.country.currency.symbol }} {{ localization.country.currency.iso_code }}</span>

    <div class="switcher-dropdown" role="menu" aria-label="Currencies">
      {% if localization.available_countries.size > 1 %}
        {% assign seen = '' %}
        <localization-form>
          {% form 'localization', id: 'country-form', action: routes.localization_url %}
            <!-- Rücksprungziel: Market-Root (verhindert „nichts passiert“ bei Domainwechseln) -->
            <input type="hidden" name="return_to" value="{{ routes.root_url }}">
            <input type="hidden" name="country_code" value="{{ localization.country.iso_code }}">

            {% for country in localization.available_countries %}
              {% assign ccurr = country.currency.iso_code %}
              {% unless seen contains ccurr %}
                {% assign seen = seen | append: ccurr | append: ',' %}
                <button type="button"
                        class="dropdown-item {% if country.iso_code == localization.country.iso_code %}active{% endif %}"
                        data-country="{{ country.iso_code }}"
                        data-currency="{{ country.currency.iso_code }}"
                        aria-pressed="{% if country.iso_code == localization.country.iso_code %}true{% else %}false{% endif %}">
                  <span>{{ country.currency.symbol }} {{ country.currency.iso_code }}</span>
                </button>
              {% endunless %}
            {% endfor %}
          {% endform %}
        </localization-form>
      {% endif %}
    </div>
  </div>

</div>

<script>
(function() {
  'use strict';

  // Hilfsfunktionen für Öffnen/Schließen der Dropdowns (nutzt deine existierenden .switcher/.switcher-dropdown Styles)
  const switchers = document.querySelectorAll('.switcher');
  function closeAll() { switchers.forEach(sw => sw.classList.remove('active')); }
  function toggle(el) {
    const isActive = el.classList.contains('active');
    closeAll();
    if (!isActive) el.classList.add('active');
  }

  // Click-Handling: nur auf Kopf klicken zum Öffnen/Schließen (nicht auf Dropdown-Inhalt)
  switchers.forEach(sw => {
    sw.addEventListener('click', function(e) {
      // Klicke auf den Header-Bereich → toggle; Klicke im Dropdown → nicht togglen
      const dropdown = sw.querySelector('.switcher-dropdown');
      if (dropdown && dropdown.contains(e.target)) return; // Klick im Dropdown
      toggle(sw);
    });
  });

  // Outside Click schließt alles
  document.addEventListener('click', function(e){
    if (![...switchers].some(sw => sw.contains(e.target))) closeAll();
  });
  document.addEventListener('keydown', function(e){ if (e.key === 'Escape') closeAll(); });

  // LANGUAGE: sichere, entkoppelte Submit-Logik
  const langForm = document.getElementById('lang-form');
  if (langForm) {
    langForm.closest('.switcher-dropdown').addEventListener('click', function(e) {
      const btn = e.target.closest('[data-language]');
      if (!btn) return;
      e.preventDefault();
      e.stopPropagation();
      try {
        langForm.querySelector('input[name="language_code"]').value = btn.dataset.language;
        langForm.submit();
      } catch (err) { console.warn('Language submit failed', err); }
    });
  }

  // COUNTRY/CURRENCY: dedupliziert per Serverseite, zuverlässiger Submit
  const countryForm = document.getElementById('country-form');
  if (countryForm) {
    countryForm.closest('.switcher-dropdown').addEventListener('click', function(e) {
      const btn = e.target.closest('[data-country]');
      if (!btn) return;
      e.preventDefault();
      e.stopPropagation();
      try {
        countryForm.querySelector('input[name="country_code"]').value = btn.dataset.country;
        countryForm.submit();
      } catch (err) { console.warn('Country submit failed', err); }
    });
  }
})();
</script>

{% schema %}
{
  "name": "Enterprise Header",
  "settings": [
    {
      "type": "header",
      "content": "Header Settings"
    }
  ]
}
{% endschema %}
