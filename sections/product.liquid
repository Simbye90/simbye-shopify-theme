<!-- sections/product.liquid -->
<!-- SIMBYE ENTERPRISE PRODUCT PAGE – FREE(0€) + MOBILE FIXES -->

<style>
  .enterprise-header.scrolled { display: none; }

  .shopify-section:has(.product-enterprise) {
    display: block !important; padding: 0 !important; margin: 0 !important;
    grid-template-columns: unset !important; max-width: 100% !important; width: 100% !important;
  }
  .shopify-section:has(.product-enterprise) > * { grid-column: unset !important; margin: 0 !important; }

  .product-enterprise { width: 100vw !important; margin: 0 !important; padding: 0 !important; position: relative !important; }

  :root {
    --product-primary:#009a61; --product-primary-dark:#00824f; --product-accent:#00d97e;
    --product-text:#1a1a1a; --product-text-secondary:#666; --product-bg:#fff; --product-card-bg:#fff;
    --product-border:rgba(0,0,0,.08); --product-shadow-sm:0 4px 12px rgba(0,0,0,.06);
    --product-shadow-md:0 8px 24px rgba(0,0,0,.08); --product-shadow-lg:0 12px 32px rgba(0,154,97,.15);
    --product-gradient:linear-gradient(135deg,#f8fffe 0%,#fff 100%); --product-radius:24px; --product-radius-sm:16px;
    --product-transition:all .3s cubic-bezier(.4,0,.2,1);
  }
  [data-theme="dark"]{
    --product-text:#f5f5f5; --product-text-secondary:#999; --product-bg:#0a0a0a;
    --product-card-bg:rgba(26,26,26,.8); --product-border:rgba(255,255,255,.08);
    --product-primary:#00d97e; --product-primary-dark:#009a61; --product-accent:#00ff88;
    --product-shadow-sm:0 4px 12px rgba(0,0,0,.3); --product-shadow-md:0 8px 24px rgba(0,0,0,.4);
    --product-shadow-lg:0 12px 32px rgba(0,217,126,.15);
    --product-gradient:linear-gradient(135deg,rgba(0,217,126,.05) 0%,transparent 100%);
  }

  .product-enterprise{background:var(--product-bg);overflow:hidden;padding-top:20px !important;min-height:100vh;position:relative;transition:var(--product-transition);}
  [data-theme="dark"] .product-enterprise{background:#0a0a0a;}

  .product-hero{max-width:1600px;margin:0 auto;padding:0 40px 80px;width:100%;position:relative;z-index:1;}
  .hero-container{display:grid;grid-template-columns:580px 1fr;gap:80px;align-items:center;}
  .hero-image-section{position:relative;animation:fadeInUp .8s ease;}
  .hero-image-wrapper{position:relative;border-radius:var(--product-radius);overflow:hidden;box-shadow:var(--product-shadow-lg);aspect-ratio:4/3;background:var(--product-card-bg);border:2px solid var(--product-border);transition:var(--product-transition);}
  [data-theme="dark"] .hero-image-wrapper{background:var(--product-card-bg);border-color:rgba(255,255,255,.08);backdrop-filter:blur(10px);}
  .hero-image{width:100%;height:100%;object-fit:cover;}

  .hero-info-section{animation:fadeInUp .8s ease .2s both;}
  .product-title-wrapper{display:flex;align-items:center;gap:16px;margin-bottom:32px;animation:fadeInUp .8s ease .3s both;}
  .product-flag{width:56px;height:42px;border-radius:12px;object-fit:cover;box-shadow:var(--product-shadow-md);border:2px solid var(--product-border);}
  .product-title{font-size:56px;font-weight:800;line-height:1.1;margin:0;letter-spacing:-.02em;color:var(--product-text);}
  .country-name{color:var(--product-primary);background:linear-gradient(135deg,var(--product-primary),var(--product-accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
  .esim-text{color:var(--product-text);} [data-theme="dark"] .esim-text{color:#fff;}

  .hero-subtitle{font-size:18px;color:var(--product-text-secondary);line-height:1.6;margin-bottom:32px;animation:fadeInUp .8s ease .4s both;}
  .hero-features{display:flex;flex-direction:column;gap:20px;margin-bottom:32px;}
  .hero-feature{display:flex;align-items:center;gap:16px;font-size:16px;color:var(--product-text);animation:fadeInUp .8s ease both;animation-delay:calc(.5s + var(--feature-index)*.1s);}
  .hero-feature:nth-child(1){--feature-index:0;} .hero-feature:nth-child(2){--feature-index:1;} .hero-feature:nth-child(3){--feature-index:2;}
  .hero-feature-icon{width:48px;height:48px;background:linear-gradient(135deg,var(--product-primary),var(--product-accent));border-radius:14px;display:flex;align-items:center;justify-content:center;position:relative;box-shadow:0 8px 20px rgba(0,154,97,.25);animation:subtlePulse 4s ease-in-out infinite;flex-shrink:0;}
  [data-theme="dark"] .hero-feature-icon{background:linear-gradient(135deg,rgba(0,217,126,.2),rgba(0,154,97,.2));box-shadow:0 8px 20px rgba(0,217,126,.2),inset 0 1px 2px rgba(255,255,255,.1);}
  .hero-feature-icon svg{width:24px;height:24px;color:#fff;stroke-width:1.8;}

  .trust-badges{display:flex;gap:20px;padding-top:24px;border-top:1px solid var(--product-border);animation:fadeInUp .8s ease .7s both;}
  .trust-badge{display:flex;align-items:center;gap:12px;color:var(--product-text-secondary);font-size:14px;transition:var(--product-transition);}
  .trust-badge:hover{transform:translateX(4px);color:var(--product-text);}
  .trust-badge svg{width:20px;height:20px;color:var(--product-primary);}

  .product-selection{max-width:1600px;margin:0 auto;padding:0 40px 80px;width:100%;position:relative;z-index:1;}
  .variant-tabs{display:flex;gap:4px;background:rgba(0,154,97,.05);padding:4px;border-radius:var(--product-radius-sm);border:1px solid rgba(0,154,97,.1);margin-bottom:32px;box-shadow:var(--product-shadow-sm);animation:fadeInUp .9s ease both;}
  [data-theme="dark"] .variant-tabs{background:rgba(0,217,126,.05);border-color:rgba(0,217,126,.1);}
  .variant-tab{flex:1;padding:16px 32px;background:transparent;border:0;border-radius:12px;font-size:18px;font-weight:600;color:var(--product-text-secondary);cursor:pointer;transition:var(--product-transition);display:flex;align-items:center;justify-content:center;gap:12px;font-family:inherit;}
  .variant-tab:hover{background:rgba(0,154,97,.08);color:var(--product-text);}
  [data-theme="dark"] .variant-tab:hover{background:rgba(0,217,126,.08);color:#fff;}
  .variant-tab.active{background:var(--product-primary);color:#fff;box-shadow:0 4px 12px rgba(0,154,97,.3);}
  .tab-icon{width:20px;height:20px;}

  .fair-use-notice{background:var(--product-card-bg);border:2px solid var(--product-border);border-radius:var(--product-radius);padding:32px;margin-bottom:32px;display:none;animation:fadeInUp .4s ease;box-shadow:var(--product-shadow-md);position:relative;overflow:hidden;}
  [data-theme="dark"] .fair-use-notice{background:var(--product-card-bg);border-color:rgba(255,255,255,.08);backdrop-filter:blur(10px);}
  .fair-use-notice.active{display:block;}
  .fair-use-header{display:flex;align-items:center;gap:12px;margin-bottom:12px;}
  .fair-use-title{font-size:18px;font-weight:700;color:var(--product-primary);margin:0;}
  .fair-use-text{font-size:15px;color:var(--product-text-secondary);line-height:1.6;margin:0;}

  .selection-grid{display:grid;grid-template-columns:1.5fr 1fr;gap:40px;}
  .plans-container{display:flex;flex-direction:column;}
  .variant-group{display:flex;flex-direction:column;}

  .plan-card{position:relative;background:var(--product-card-bg);border:2px solid var(--product-border);border-radius:var(--product-radius);padding:36px 28px;cursor:pointer;transition:var(--product-transition);overflow:visible;margin-bottom:24px !important;box-shadow:var(--product-shadow-md);animation:fadeInUp .9s ease both;}
  .plan-card:nth-child(1){animation-delay:.1s;} .plan-card:nth-child(2){animation-delay:.2s;} .plan-card:nth-child(3){animation-delay:.3s;}
  [data-theme="dark"] .plan-card{background:var(--product-card-bg);border-color:rgba(255,255,255,.08);backdrop-filter:blur(10px);}
  .plan-card:hover{border-color:var(--product-primary);transform:translateY(-2px);box-shadow:var(--product-shadow-lg);}
  .plan-card.selected{border-color:var(--product-primary);background:var(--product-card-bg);box-shadow:var(--product-shadow-lg);}

  .plan-content{display:flex;justify-content:space-between;align-items:center;position:relative;z-index:1;}
  .plan-info{flex:1;}
  .plan-name{font-size:24px;font-weight:700;color:var(--product-text);margin-bottom:8px;letter-spacing:-.01em;line-height:1.2;}
  .plan-validity{font-size:15px;color:var(--product-text-secondary);line-height:1.6;}
  .plan-price-wrapper{text-align:right;}
  .plan-price-old{display:block;font-size:16px;color:var(--product-text-secondary);text-decoration:line-through;margin-bottom:4px;opacity:.7;}
  .plan-price{font-size:32px;font-weight:800;color:var(--product-primary);letter-spacing:-.02em;line-height:1;}

  .free-badge{position:absolute;top:-12px;left:20px;background:linear-gradient(135deg,var(--product-accent),#00ff88);color:#0a0a0a;padding:6px 16px;border-radius:100px;font-weight:700;font-size:12px;text-transform:uppercase;box-shadow:0 6px 20px rgba(0,217,126,.4);z-index:2;}
  .free-login-button{display:inline-flex;align-items:center;justify-content:center;padding:12px 24px;background:linear-gradient(135deg,var(--product-primary),var(--product-accent));color:#fff;border:none;border-radius:100px;font-weight:700;font-size:15px;text-decoration:none;transition:var(--product-transition);white-space:nowrap;box-shadow:0 8px 24px rgba(0,154,97,.25);}

  .popular-badge{position:absolute;top:-12px;right:20px;background:linear-gradient(135deg,#ff7e50,#ff9a76);color:#fff;padding:6px 16px;border-radius:100px;font-size:12px;font-weight:700;text-transform:uppercase;box-shadow:0 6px 20px rgba(255,126,80,.4);z-index:2;}

  .purchase-box{position:sticky;top:120px;background:var(--product-card-bg);border:2px solid var(--product-border);border-radius:var(--product-radius);padding:36px 32px;box-shadow:var(--product-shadow-lg);animation:fadeInUp .9s ease .7s both;}
  [data-theme="dark"] .purchase-box{background:var(--product-card-bg);border-color:rgba(255,255,255,.08);backdrop-filter:blur(10px);}
  .purchase-title{font-size:24px;font-weight:700;color:var(--product-text);margin-bottom:24px;letter-spacing:-.01em;}
  .summary-box{background:var(--product-gradient);border-radius:16px;padding:24px;margin-bottom:24px;border:1px solid var(--product-border);}
  .summary-row{display:flex;justify-content:space-between;align-items:center;padding:10px 0;}
  .summary-row:not(:last-child){border-bottom:1px solid var(--product-border);}
  .summary-label{font-size:15px;color:var(--product-text-secondary);}
  .summary-value{font-size:16px;font-weight:600;color:var(--product-text);}
  .summary-row:last-child .summary-label,.summary-row:last-child .summary-value{font-size:18px;font-weight:700;color:var(--product-primary);}

  .checkout-button{width:100%;background:linear-gradient(135deg,var(--product-primary),var(--product-accent));color:#fff;border:none;border-radius:100px;padding:20px;font-size:18px;font-weight:700;cursor:pointer;transition:var(--product-transition);box-shadow:0 10px 30px rgba(0,154,97,.3);display:flex;align-items:center;justify-content:center;gap:12px;margin-bottom:24px;position:relative;}
  .checkout-button:hover:not(:disabled){transform:translateY(-3px) scale(1.02);box-shadow:var(--product-shadow-lg);}
  .checkout-button:active:not(:disabled){transform:scale(.98);}

  .payment-methods{display:flex;justify-content:center;gap:12px;padding-top:24px;border-top:1px solid var(--product-border);}
  .payment-method{height:24px;opacity:.7;transition:var(--product-transition);}
  .payment-method:hover{opacity:1;transform:scale(1.1);}

  @keyframes fadeInUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
  @keyframes subtlePulse{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-3px) scale(1.02)}}

  .sticky-cart{display:none;}
  /* MOBILE */
  @media (max-width:768px){
    .product-enterprise{padding-top:0 !important;}
    .product-hero{padding:0 !important;max-width:100% !important;margin-bottom:32px;}
    .hero-container{grid-template-columns:1fr;gap:0;position:relative;}
    .hero-image-section{position:absolute;inset:0;width:100vw !important;height:100%;z-index:1;}
    .hero-image-wrapper{border-radius:0 !important;border:none !important;width:100vw !important;height:100%;margin:0 !important;box-shadow:none !important;}
    .hero-image-wrapper::after{content:'';position:absolute;inset:0;background:linear-gradient(to bottom,rgba(255,255,255,.5) 0%,rgba(255,255,255,.75) 50%,rgba(255,255,255,.92) 100%);z-index:1;}
    [data-theme="dark"] .hero-image-wrapper::after{background:linear-gradient(to bottom,rgba(10,10,10,.75) 0%,rgba(10,10,10,.88) 50%,rgba(10,10,10,.96) 100%);}
    .hero-info-section{position:relative;z-index:4;padding:60px 20px 40px !important;text-align:left;}
    .product-title-wrapper{justify-content:flex-start;margin-bottom:20px;align-items:flex-start;gap:12px;}
    .product-flag{width:48px;height:48px;border-radius:50%;border:2px solid #fff;}
    [data-theme="dark"] .product-flag{border-color:rgba(255,255,255,.1);}
    .product-title{font-size:28px;line-height:1.2;}
    .hero-subtitle{font-size:15px;margin-bottom:20px;line-height:1.5;}
    .hero-feature{font-size:14px;}
    .hero-feature-icon{width:40px;height:40px;border-radius:12px;}
    .hero-feature-icon svg{width:20px;height:20px;}
    .trust-badges{display:none !important;}

    .product-selection{padding:0 20px 60px !important;}
    .selection-grid{grid-template-columns:1fr;gap:24px;}
    .purchase-box{display:none !important;}

    .variant-tabs{margin-bottom:20px;}
    .variant-tab{padding:12px 16px;font-size:15px;}

    .plan-card{margin-bottom:16px !important;padding:24px 20px;border-radius:20px;}
    .plan-name{font-size:19px;}
    .plan-price{font-size:26px;}
    .plan-price-old{font-size:14px;}

    /* Sticky Cart */
    .sticky-cart{display:block;position:fixed;bottom:0;left:0;width:100%;background:var(--product-card-bg);box-shadow:0 -2px 10px rgba(0,0,0,.15);z-index:999;padding:10px 16px;transform:translateY(100%);transition:transform .3s ease;border-top:1px solid var(--product-border);}
    [data-theme="dark"] .sticky-cart{background:#1a1a1a;box-shadow:0 -2px 10px rgba(0,0,0,.3);}
    .sticky-cart.active{transform:translateY(0);}
    .sticky-cart-header{display:flex;align-items:center;justify-content:center;position:relative;padding:5px 0;}
    .sticky-cart-menu{position:absolute;right:0;top:50%;transform:translateY(-50%);}
    .sticky-cart-menu a{display:inline-flex;align-items:center;justify-content:center;text-decoration:none;color:var(--product-text);}
    .sticky-cart-title{font-size:16px;font-weight:700;color:var(--product-text);}
    .sticky-cart-button{display:flex;justify-content:center;align-items:center;width:100%;background:linear-gradient(135deg,var(--product-primary),var(--product-accent));border-radius:100px;text-decoration:none;padding:17px 24px;color:#fff;font-weight:700;font-size:16px;gap:10px;margin-top:10px;border:none;cursor:pointer;box-shadow:0 8px 24px rgba(0,154,97,.25);}
    .sticky-cart-button:active{transform:scale(.98);}
  }

  @media (prefers-reduced-motion:reduce){*{animation-duration:.01ms !important;animation-iteration-count:1 !important;transition-duration:.01ms !important;}}
</style>

{% comment %}
  FREE(0€) – Block-Flag ermitteln
  - Kunde mit Tag `free_100mb_redeemed` → blockiert
  - Fallback: Orders scannen (bis 50), wenn irgendeine Line eine 0-€-Variante dieses Produkts war
{% endcomment %}
{% assign free_variant_ids = '' %}
{% for v in product.variants %}
  {% if v.price == 0 %}
    {% assign free_variant_ids = free_variant_ids | append: v.id | append: ',' %}
  {% endif %}
{% endfor %}

{% assign free_blocked = false %}
{% if customer %}
  {% if customer.tags contains 'free_100mb_redeemed' %}
    {% assign free_blocked = true %}
  {% endif %}
  {% if free_blocked == false and customer.orders_count > 0 %}
    {% for order in customer.orders limit: 50 %}
      {% for line in order.line_items %}
        {% if free_variant_ids contains line.variant_id %}
          {% assign free_blocked = true %}
        {% endif %}
      {% endfor %}
      {% if free_blocked %}{% break %}{% endif %}
    {% endfor %}
  {% endif %}
{% endif %}

<section class="product-enterprise" data-product-id="{{ product.id }}">
  <div class="product-hero">
    <div class="hero-container">
      <div class="hero-image-section">
        <div class="hero-image-wrapper">
          {% if product.images[1] %}
            {{ product.images[1] | image_url: width: 800 | image_tag: class: 'hero-image', loading: 'eager', fetchpriority: 'high', alt: product.title }}
          {% else %}
            {{ product.featured_image | image_url: width: 800 | image_tag: class: 'hero-image', loading: 'eager', fetchpriority: 'high', alt: product.title }}
          {% endif %}
        </div>
      </div>

      <div class="hero-info-section">
        <div class="product-title-wrapper">
          {% if product.featured_image %}
            {{ product.featured_image | image_url: width: 80 | image_tag: class: 'product-flag', alt: product.title }}
          {% endif %}
          <h1 class="product-title">
            {% assign title_parts = product.title | split: ' ' %}
            <span class="country-name">{{ title_parts[0] }}</span>
            <span class="esim-text">eSIM</span>
          </h1>
        </div>

        <p class="hero-subtitle">
          {{ 'product.hero_subtitle' | t: country: product.title | default: 'Prepaid eSIM data plans. Activated in 60 seconds, keep your WhatsApp number, no contract.' }}
        </p>

        <div class="hero-features">
          <div class="hero-feature"><div class="hero-feature-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          </div><span>{{ 'product.instant_delivery' | t | default: 'Instant delivery' }}</span></div>
          <div class="hero-feature"><div class="hero-feature-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z"/></svg>
          </div><span>{{ 'product.premium_network' | t | default: 'Premium 4G/5G network' }}</span></div>
          <div class="hero-feature"><div class="hero-feature-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zM21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 01-2.555-.337A5.972 5.972 0 015.41 20.97a5.969 5.969 0 01-.474-.065 4.48 4.48 0 00.978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25z"/></svg>
          </div><span>{{ 'product.whatsapp_support' | t | default: '24/7 WhatsApp support' }}</span></div>
        </div>

        <div class="trust-badges">
          <div class="trust-badge"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z"/></svg><span>{{ 'product.money_back' | t | default: 'Money-back guarantee' }}</span></div>
          <div class="trust-badge"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z"/></svg><span>{{ 'product.secure_payment' | t | default: 'Secure payment' }}</span></div>
        </div>
      </div>
    </div>
  </div>

  <div class="product-selection">
    {% assign has_unlimited = false %}
    {% for variant in product.variants %}
      {% if variant.sku contains 'daily' or variant.sku contains 'Daily' or variant.sku contains 'unlimited' %}
        {% assign has_unlimited = true %}
      {% endif %}
    {% endfor %}

    {% if has_unlimited %}
      <div class="variant-tabs">
        <button class="variant-tab active" data-tab="normal">
          <svg class="tab-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125"/></svg>
          <span>{{ 'product.data_plans' | t | default: 'Data Plans' }}</span>
        </button>
        <button class="variant-tab" data-tab="unlimited">
          <svg class="tab-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9.5 12c0 1.657-1.343 3-3 3s-3-1.343-3-3 1.343-3 3-3 3 1.343 3 3zM14.5 12c0-1.657 1.343-3 3-3s3 1.343 3 3-1.343 3-3 3-3-1.343-3-3z"/><path d="M9.5 12h5"/></svg>
          <span>{{ 'product.unlimited_daily' | t | default: 'Unlimited Daily' }}</span>
        </button>
      </div>

      <div class="fair-use-notice" id="fair-use-notice">
        <div class="fair-use-header">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"/></svg>
          <h3 class="fair-use-title">{{ 'product.fair_use_title' | t | default: 'Fair Use Policy' }}</h3>
        </div>
        <p class="fair-use-text">{{ 'product.fair_use_text' | t | default: '1GB daily at high speed. After 1GB, speed reduced to 128kbps. Data resets daily at midnight.' }}</p>
      </div>
    {% endif %}

    <div class="selection-grid">
      <div class="plans-container">
        <!-- NORMAL VARIANTS -->
        <div class="variant-group" id="normal-variants" style="display:block;">
          {% assign variant_index = 0 %}
          {% for variant in product.variants %}
            {% unless variant.sku contains 'daily' or variant.sku contains 'Daily' or variant.sku contains 'unlimited' %}
              {% assign variant_index = variant_index | plus: 1 %}
              {% assign is_free = false %}
              {% if variant.price == 0 %}
                {% assign is_free = true %}
              {% endif %}

              {% unless is_free and free_blocked %}
              <div class="plan-card {% if variant_index == 1 and is_free == false %}selected{% endif %}"
                   data-variant-id="{{ variant.id }}"
                   data-is-free="{{ is_free }}">

                {% if is_free %}
                  <span class="free-badge">FREE</span>
                {% endif %}

                {% if variant_index == 3 %}
                  <span class="popular-badge">{{ 'product.popular' | t | default: 'POPULAR' }}</span>
                {% endif %}

                <input type="radio"
                       name="variant"
                       value="{{ variant.id }}"
                       data-price="{% if is_free %}FREE{% else %}{{ variant.price | money }}{% endif %}"
                       data-title="{% if is_free %}Free 100MB eSIM{% else %}{{ variant.title }}{% endif %}"
                       {% if variant_index == 1 and is_free == false %}checked{% endif %}
                       style="display:none;">

                <div class="plan-content">
                  <div class="plan-info">
                    <div class="plan-name">
                      {% if is_free %}Free 100MB eSIM{% else %}{{ variant.title }}{% endif %}
                    </div>
                    <div class="plan-validity">
                      {% if is_free %}
                        {{ 'product.valid_for' | t | default: 'Valid for' }} 7 {{ 'product.days' | t | default: 'days' }}
                      {% else %}
                        {{ 'product.valid_for' | t | default: 'Valid for' }}
                        {% assign title_parts = variant.title | split: " " %}
                        {% assign days_index = title_parts.size | minus: 2 %}
                        {{ title_parts[days_index] }} {{ 'product.days' | t | default: 'days' }}
                      {% endif %}
                    </div>
                  </div>
                  <div class="plan-price-wrapper">
                    {% if is_free %}
                      {% if customer %}
                        <span class="plan-price">FREE</span>
                      {% else %}
                        <a href="/account/login?return_url={{ request.url | url_encode }}&claim=free100"
                           class="free-login-button">
                          {{ 'product.login_for_free' | t | default: 'Login for FREE' }}
                        </a>
                      {% endif %}
                    {% else %}
                      {% if section.settings.show_compare_price %}
                        {% if variant.compare_at_price and variant.compare_at_price > variant.price %}
                          <span class="plan-price-old">{{ variant.compare_at_price | money }}</span>
                        {% elsif section.settings.price_increase_percent > 0 %}
                          {% assign multiplier = section.settings.price_increase_percent | plus: 100 | times: 1.0 | divided_by: 100 %}
                          {% assign old_price = variant.price | times: multiplier %}
                          <span class="plan-price-old">{{ old_price | money }}</span>
                        {% endif %}
                      {% endif %}
                      <span class="plan-price">{{ variant.price | money }}</span>
                    {% endif %}
                  </div>
                </div>
              </div>
              {% endunless %}
            {% endunless %}
          {% endfor %}
        </div>

        <!-- UNLIMITED VARIANTS -->
        {% if has_unlimited %}
          <div class="variant-group" id="unlimited-variants" style="display:none;">
            {% for variant in product.variants %}
              {% if variant.sku contains 'daily' or variant.sku contains 'Daily' or variant.sku contains 'unlimited' %}
                <div class="plan-card" data-variant-id="{{ variant.id }}">
                  <input type="radio" name="variant" value="{{ variant.id }}"
                         data-price="{{ variant.price | money }}"
                         data-title="{{ variant.title }}"
                         style="display:none;">
                  <div class="plan-content">
                    <div class="plan-info">
                      <div class="plan-name">{{ variant.title }}</div>
                      <div class="plan-validity">{{ 'product.gb_per_day_for' | t: days: variant.title | default: '1GB/day' }}</div>
                    </div>
                    <div class="plan-price-wrapper">
                      {% if section.settings.show_compare_price %}
                        {% if variant.compare_at_price and variant.compare_at_price > variant.price %}
                          <span class="plan-price-old">{{ variant.compare_at_price | money }}</span>
                        {% elsif section.settings.price_increase_percent > 0 %}
                          {% assign multiplier = section.settings.price_increase_percent | plus: 100 | times: 1.0 | divided_by: 100 %}
                          {% assign old_price = variant.price | times: multiplier %}
                          <span class="plan-price-old">{{ old_price | money }}</span>
                        {% endif %}
                      {% endif %}
                      <span class="plan-price">{{ variant.price | money }}</span>
                    </div>
                  </div>
                </div>
              {% endif %}
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <!-- PURCHASE BOX (Desktop) -->
      <div class="purchase-box">
        <h3 class="purchase-title">{{ 'product.your_selection' | t | default: 'Your Selection' }}</h3>
        <div class="summary-box">
          <div class="summary-row"><span class="summary-label">{{ product.title }} eSIM</span><span class="summary-value" id="selected-variant">-</span></div>
          <div class="summary-row"><span class="summary-label">{{ 'product.network' | t | default: 'Network' }}</span><span class="summary-value">{{ product.metafields.custom.plantyp | default: 'Avea, Turkcell' }}</span></div>
          <div class="summary-row"><span class="summary-label">{{ 'product.activation' | t | default: 'Activation' }}</span><span class="summary-value">{{ 'product.instant' | t | default: 'Instant' }}</span></div>
          <div class="summary-row"><span class="summary-label">{{ 'product.total' | t | default: 'Total' }}</span><span class="summary-value" id="total-price">-</span></div>
        </div>

        <form action="/cart/add?return_to=/checkout" method="post" id="product-form">
          <input type="hidden" name="id" id="variant-input" value="">
          <button type="submit" class="checkout-button">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width:20px;height:20px;"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z"/></svg>
            <span>{{ 'product.buy_now' | t | default: 'Buy Now' }}</span>
          </button>
        </form>

        <div class="payment-methods">
          {% assign payment_types = 'visa,master,apple_pay,google_pay,paypal' | split: ',' %}
          {% for type in payment_types %}{{ type | payment_type_svg_tag: class: 'payment-method' }}{% endfor %}
        </div>
      </div>
    </div>
  </div>

  <!-- MOBILE STICKY CART -->
  <div class="sticky-cart" id="sticky-cart">
    <div class="sticky-cart-header">
      <div class="sticky-cart-title" id="sticky-title">-</div>
      <div class="sticky-cart-menu">
        <a href="#product-selection" id="sticky-menu-trigger" aria-label="Open menu">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"/></svg>
        </a>
      </div>
    </div>
    <button class="sticky-cart-button" id="sticky-button">{{ 'product.buy_now' | t | default: 'Buy Now' }}</button>
  </div>
</section>

<script>
(function(){
  'use strict';

  const section = document.querySelector('.product-enterprise');
  const variantTabs = section.querySelectorAll('.variant-tab');
  const normalGroup = section.querySelector('#normal-variants');
  const unlimitedGroup = section.querySelector('#unlimited-variants');
  const fairUseNotice = section.querySelector('#fair-use-notice');
  const planCards = section.querySelectorAll('.plan-card');
  const variantInput = section.querySelector('#variant-input');
  const selectedVariantText = section.querySelector('#selected-variant');
  const totalPriceText = section.querySelector('#total-price');
  const productForm = section.querySelector('#product-form');

  const stickyCart = document.querySelector('#sticky-cart');
  const stickyTitle = document.querySelector('#sticky-title');
  const stickyButton = document.querySelector('#sticky-button');

  const isCustomerLoggedIn = {{ customer.id | default: 'null' }} !== null;
  const freeBlocked = {{ free_blocked | json }};

  // Tabs
  if (variantTabs.length){
    variantTabs.forEach(tab=>{
      tab.addEventListener('click', function(){
        variantTabs.forEach(t=>t.classList.remove('active'));
        this.classList.add('active');
        const tabType = this.dataset.tab;
        if (tabType === 'unlimited'){
          if (normalGroup) normalGroup.style.display='none';
          if (unlimitedGroup) unlimitedGroup.style.display='block';
          if (fairUseNotice) fairUseNotice.classList.add('active');
        } else {
          if (normalGroup) normalGroup.style.display='block';
          if (unlimitedGroup) unlimitedGroup.style.display='none';
          if (fairUseNotice) fairUseNotice.classList.remove('active');
        }
        const activeGroup = tabType === 'unlimited' ? unlimitedGroup : normalGroup;
        const firstCard = activeGroup?.querySelector('.plan-card:not([data-is-free="true"])') || activeGroup?.querySelector('.plan-card');
        if (firstCard){ selectPlan(firstCard); }
      });
    });
  }

  // Auswahl
  function selectPlan(card){
    const isFree = card.dataset.isFree === 'true';
    if (isFree){
      if (!isCustomerLoggedIn){
        // Nicht eingeloggt → Login-Button in Karte verwenden
        const loginBtn = card.querySelector('.free-login-button');
        if (loginBtn){ loginBtn.focus(); }
        return;
      }
      if (freeBlocked){
        alert('This free 100MB eSIM has already been claimed on your account.');
        return;
      }
    }
    document.querySelectorAll('.plan-card').forEach(c=>c.classList.remove('selected'));
    card.classList.add('selected');

    const radio = card.querySelector('input[type="radio"]');
    if (radio){
      radio.checked = true;
      const currentVariant = { id: radio.value, price: radio.dataset.price, title: radio.dataset.title };
      variantInput.value = currentVariant.id;
      if (selectedVariantText) selectedVariantText.textContent = currentVariant.title || '-';
      if (totalPriceText) totalPriceText.textContent = currentVariant.price || '-';
      if (stickyTitle) stickyTitle.textContent = (currentVariant.title || '-') + ' - ' + (currentVariant.price || '');
    }
  }

  // Karten-Klick
  planCards.forEach(card=>{
    card.addEventListener('click', function(e){
      if (e.target.closest('a')) return;
      selectPlan(this);
    });
  });

  // Form-Submit – harte FREE-Sperre
  productForm.addEventListener('submit', function(e){
    const selectedCard = section.querySelector('.plan-card.selected');
    if (!selectedCard){
      e.preventDefault();
      alert('{{ "product.select_variant" | t | default: "Please select a variant" }}');
      return;
    }
    const isFreeChosen = selectedCard.dataset.isFree === 'true';
    if (isFreeChosen && !isCustomerLoggedIn){
      e.preventDefault();
      const loginLink = selectedCard.querySelector('.free-login-button');
      if (loginLink) window.location.href = loginLink.getAttribute('href');
      return;
    }
    if (isFreeChosen && freeBlocked){
      e.preventDefault();
      alert('This free 100MB eSIM has already been claimed on your account.');
      return;
    }
  });

  // Mobile Sticky
  let ticking = false;
  window.addEventListener('scroll', function(){
    if (!ticking && window.innerWidth <= 768){
      window.requestAnimationFrame(function(){
        const selectionTop = section.querySelector('.product-selection')?.offsetTop || 0;
        const scrolled = window.scrollY > selectionTop - 200;
        if (stickyCart) stickyCart.classList.toggle('active', scrolled);
        ticking = false;
      });
      ticking = true;
    }
  });

  // Sticky Buy → echter Submit
  if (stickyButton){
    stickyButton.addEventListener('click', function(){
      // Fallback: erste nicht-FREE wählen, sonst erste Karte
      const selected = section.querySelector('.plan-card.selected');
      if (!selected){
        const fallback = section.querySelector('.plan-card:not([data-is-free="true"])') || section.querySelector('.plan-card');
        if (fallback) selectPlan(fallback);
      }
      if (typeof productForm.requestSubmit === 'function'){ productForm.requestSubmit(); }
      else { productForm.submit(); }
    });
  }

  // Sticky Menü → Header-Menü öffnen
  const stickyMenuTrigger = document.getElementById('sticky-menu-trigger');
  if (stickyMenuTrigger){
    stickyMenuTrigger.addEventListener('click', function(e){
      e.preventDefault();
      const headerToggle = document.getElementById('mobile-toggle');
      if (headerToggle) headerToggle.click();
    });
  }

  // Nach Login zurück mit claim=free100 → FREE vorauswählen (wenn erlaubt)
  try{
    const params = new URLSearchParams(location.search);
    if (params.get('claim') === 'free100' && !freeBlocked && isCustomerLoggedIn){
      const freeCard = section.querySelector('.plan-card[data-is-free="true"]');
      if (freeCard) selectPlan(freeCard);
    }
  }catch(_){}

  // Init – erste nicht-FREE auswählen
  const firstCard = section.querySelector('.plan-card:not([data-is-free="true"])') || section.querySelector('.plan-card');
  if (firstCard) selectPlan(firstCard);
})();
</script>

{% schema %}
{
  "name": "Product Page",
  "settings": [
    { "type": "header", "content": "Pricing Display" },
    { "type": "checkbox", "id": "show_compare_price", "label": "Show Compare at Price", "default": false },
    { "type": "range", "id": "price_increase_percent", "label": "Price Increase Percentage", "min": 0, "max": 100, "step": 5, "default": 0, "unit": "%" }
  ],
  "presets": [{ "name": "Product Page" }]
}
{% endschema %}
