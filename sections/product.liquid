<!-- sections/product.liquid -->
<!-- SIMBYE ENTERPRISE PRODUCT PAGE V14.0 - ALL CRITICAL FIXES -->

<style>
.enterprise-header.scrolled {
  display: none;
}

/* KILL SHOPIFY GRID */
.shopify-section:has(.product-enterprise) {
  display: block !important;
  padding: 0 !important;
  margin: 0 !important;
  grid-template-columns: unset !important;
  max-width: 100% !important;
  width: 100% !important;
}

.product-enterprise {
  width: 100vw !important;
  margin: 0 !important;
  padding: 0 !important;
  position: relative !important;
}

/* CSS Variables */
:root {
  --product-primary: #009a61;
  --product-primary-dark: #00824f;
  --product-accent: #00d97e;
  --product-text: #1a1a1a;
  --product-text-secondary: #666666;
  --product-bg: #ffffff;
  --product-card-bg: #ffffff;
  --product-border: rgba(0, 0, 0, 0.08);
  --product-shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.06);
  --product-shadow-md: 0 8px 24px rgba(0, 0, 0, 0.08);
  --product-shadow-lg: 0 12px 32px rgba(0, 154, 97, 0.15);
  --product-gradient: linear-gradient(135deg, #f8fffe 0%, #ffffff 100%);
  --product-radius: 24px;
  --product-radius-sm: 16px;
  --product-transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

[data-theme="dark"] {
  --product-text: #f5f5f5;
  --product-text-secondary: #999999;
  --product-bg: #0a0a0a;
  --product-card-bg: rgba(26, 26, 26, 0.8);
  --product-border: rgba(255, 255, 255, 0.08);
  --product-primary: #00d97e;
  --product-accent: #00ff88;
  --product-shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.3);
  --product-shadow-md: 0 8px 24px rgba(0, 0, 0, 0.4);
  --product-shadow-lg: 0 12px 32px rgba(0, 217, 126, 0.15);
}

/* Main Section */
.product-enterprise {
  background: var(--product-bg);
  overflow: hidden;
  padding-top: 20px !important;
  min-height: 100vh;
  position: relative;
  transition: var(--product-transition);
}

[data-theme="dark"] .product-enterprise {
  background: #0a0a0a;
}

/* Hero Section */
.product-hero {
  max-width: 1600px;
  margin: 0 auto;
  padding: 0 40px 80px;
  width: 100%;
  position: relative;
  z-index: 1;
}

.hero-container {
  display: grid;
  grid-template-columns: 580px 1fr;
  gap: 80px;
  align-items: center;
}

.hero-image-section {
  position: relative;
  animation: fadeInUp 0.8s ease;
}

.hero-image-wrapper {
  position: relative;
  border-radius: var(--product-radius);
  overflow: hidden;
  box-shadow: var(--product-shadow-lg);
  aspect-ratio: 4/3;
  background: var(--product-card-bg);
  border: 2px solid var(--product-border);
  transition: var(--product-transition);
}

[data-theme="dark"] .hero-image-wrapper {
  background: var(--product-card-bg);
  border-color: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(10px);
}

.hero-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.hero-info-section {
  animation: fadeInUp 0.8s ease 0.2s both;
}

.product-title-wrapper {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 32px;
  animation: fadeInUp 0.8s ease 0.3s both;
}

.product-flag {
  width: 56px;
  height: 42px;
  border-radius: 12px;
  object-fit: cover;
  box-shadow: var(--product-shadow-md);
  border: 2px solid var(--product-border);
  transition: var(--product-transition);
}

.product-title {
  font-size: 56px;
  font-weight: 800;
  line-height: 1.1;
  margin: 0;
  letter-spacing: -0.02em;
  color: var(--product-text);
}

.country-name {
  color: var(--product-primary);
  background: linear-gradient(135deg, var(--product-primary), var(--product-accent));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.esim-text {
  color: var(--product-text);
}

[data-theme="dark"] .esim-text {
  color: #ffffff;
}

.hero-subtitle {
  font-size: 18px;
  color: var(--product-text-secondary);
  line-height: 1.6;
  margin-bottom: 32px;
  animation: fadeInUp 0.8s ease 0.4s both;
}

.hero-features {
  display: flex;
  flex-direction: column;
  gap: 20px;
  margin-bottom: 32px;
}

.hero-feature {
  display: flex;
  align-items: center;
  gap: 16px;
  font-size: 16px;
  color: var(--product-text);
  animation: fadeInUp 0.8s ease both;
  animation-delay: calc(0.5s + var(--feature-index) * 0.1s);
}

.hero-feature:nth-child(1) { --feature-index: 0; }
.hero-feature:nth-child(2) { --feature-index: 1; }
.hero-feature:nth-child(3) { --feature-index: 2; }

.hero-feature-icon {
  width: 48px;
  height: 48px;
  background: linear-gradient(135deg, var(--product-primary), var(--product-accent));
  border-radius: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 8px 20px rgba(0, 154, 97, 0.25);
  flex-shrink: 0;
}

[data-theme="dark"] .hero-feature-icon {
  background: linear-gradient(135deg, rgba(0, 217, 126, 0.2), rgba(0, 154, 97, 0.2));
  box-shadow: 0 8px 20px rgba(0, 217, 126, 0.2);
}

.hero-feature-icon svg {
  width: 24px;
  height: 24px;
  color: white;
  stroke-width: 1.8;
}

[data-theme="dark"] .hero-feature-icon svg {
  color: var(--product-primary);
}

.trust-badges {
  display: flex;
  gap: 20px;
  padding-top: 24px;
  border-top: 1px solid var(--product-border);
  animation: fadeInUp 0.8s ease 0.7s both;
}

.trust-badge {
  display: flex;
  align-items: center;
  gap: 12px;
  color: var(--product-text-secondary);
  font-size: 14px;
  transition: var(--product-transition);
}

.trust-badge svg {
  width: 20px;
  height: 20px;
  color: var(--product-primary);
}

/* Selection Section */
.product-selection {
  max-width: 1600px;
  margin: 0 auto;
  padding: 0 40px 80px;
  width: 100%;
  position: relative;
  z-index: 1;
}

.variant-tabs {
  display: flex;
  gap: 4px;
  background: rgba(0, 154, 97, 0.05);
  padding: 4px;
  border-radius: var(--product-radius-sm);
  border: 1px solid rgba(0, 154, 97, 0.1);
  margin-bottom: 32px;
  box-shadow: var(--product-shadow-sm);
}

.variant-tab {
  flex: 1;
  padding: 16px 32px;
  background: transparent;
  border: none;
  border-radius: 12px;
  font-size: 18px;
  font-weight: 600;
  color: var(--product-text-secondary);
  cursor: pointer;
  transition: var(--product-transition);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  font-family: inherit;
}

.variant-tab.active {
  background: var(--product-primary);
  color: white;
  box-shadow: 0 4px 12px rgba(0, 154, 97, 0.3);
}

.tab-icon {
  width: 20px;
  height: 20px;
}

.selection-grid {
  display: grid;
  grid-template-columns: 1.5fr 1fr;
  gap: 40px;
}

.plans-container {
  display: flex;
  flex-direction: column;
}

.variant-group {
  display: flex;
  flex-direction: column;
}

/* Plan Cards */
.plan-card {
  position: relative;
  background: var(--product-card-bg);
  border: 2px solid var(--product-border);
  border-radius: var(--product-radius);
  padding: 36px 28px;
  cursor: pointer;
  transition: var(--product-transition);
  margin-bottom: 24px !important;
  box-shadow: var(--product-shadow-md);
}

[data-theme="dark"] .plan-card {
  background: var(--product-card-bg);
  border-color: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(10px);
}

.plan-card:hover {
  border-color: var(--product-primary);
  transform: translateY(-2px);
  box-shadow: var(--product-shadow-lg);
}

.plan-card.selected {
  border-color: var(--product-primary);
  box-shadow: var(--product-shadow-lg);
}

/* HIDE FREE PLAN wenn bereits gekauft */
.plan-card[data-is-free="true"].already-claimed {
  display: none !important;
}

.plan-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.plan-info {
  flex: 1;
}

.plan-name {
  font-size: 24px;
  font-weight: 700;
  color: var(--product-text);
  margin-bottom: 8px;
  letter-spacing: -0.01em;
}

.plan-validity {
  font-size: 15px;
  color: var(--product-text-secondary);
}

.plan-price-wrapper {
  text-align: right;
}

.plan-price-old {
  display: block;
  font-size: 16px;
  color: var(--product-text-secondary);
  text-decoration: line-through;
  margin-bottom: 4px;
  opacity: 0.7;
}

.plan-price {
  font-size: 32px;
  font-weight: 800;
  color: var(--product-primary);
  letter-spacing: -0.02em;
}

.free-badge {
  position: absolute;
  top: -12px;
  left: 20px;
  background: linear-gradient(135deg, var(--product-accent), #00ff88);
  color: #0a0a0a;
  padding: 6px 16px;
  border-radius: 100px;
  font-weight: 700;
  font-size: 12px;
  text-transform: uppercase;
  box-shadow: 0 6px 20px rgba(0, 217, 126, 0.4);
  z-index: 2;
}

.free-login-button {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 12px 24px;
  background: linear-gradient(135deg, var(--product-primary), var(--product-accent));
  color: white;
  border: none;
  border-radius: 100px;
  font-weight: 700;
  font-size: 15px;
  text-decoration: none;
  transition: var(--product-transition);
  box-shadow: 0 8px 24px rgba(0, 154, 97, 0.25);
}

.free-login-button:hover {
  transform: translateY(-2px);
  box-shadow: var(--product-shadow-lg);
}

.popular-badge {
  position: absolute;
  top: -12px;
  right: 20px;
  background: linear-gradient(135deg, #ff7e50, #ff9a76);
  color: white;
  padding: 6px 16px;
  border-radius: 100px;
  font-size: 12px;
  font-weight: 700;
  text-transform: uppercase;
  box-shadow: 0 6px 20px rgba(255, 126, 80, 0.4);
  z-index: 2;
}

/* Purchase Box */
.purchase-box {
  position: sticky;
  top: 120px;
  background: var(--product-card-bg);
  border: 2px solid var(--product-border);
  border-radius: var(--product-radius);
  padding: 36px 32px;
  box-shadow: var(--product-shadow-lg);
}

.purchase-title {
  font-size: 24px;
  font-weight: 700;
  color: var(--product-text);
  margin-bottom: 24px;
}

.summary-box {
  background: var(--product-gradient);
  border-radius: 16px;
  padding: 24px;
  margin-bottom: 24px;
  border: 1px solid var(--product-border);
}

.summary-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 0;
}

.summary-row:not(:last-child) {
  border-bottom: 1px solid var(--product-border);
}

.summary-label {
  font-size: 15px;
  color: var(--product-text-secondary);
}

.summary-value {
  font-size: 16px;
  font-weight: 600;
  color: var(--product-text);
}

.checkout-button {
  width: 100%;
  background: linear-gradient(135deg, var(--product-primary), var(--product-accent));
  color: white;
  border: none;
  border-radius: 100px;
  padding: 20px;
  font-size: 18px;
  font-weight: 700;
  cursor: pointer;
  transition: var(--product-transition);
  box-shadow: 0 10px 30px rgba(0, 154, 97, 0.3);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  margin-bottom: 24px;
}

.checkout-button:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: var(--product-shadow-lg);
}

.payment-methods {
  display: flex;
  justify-content: center;
  gap: 12px;
  padding-top: 24px;
  border-top: 1px solid var(--product-border);
}

.payment-method {
  height: 24px;
  opacity: 0.7;
}

/* Animations */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Mobile Sticky Cart */
.sticky-cart {
  display: none;
}

/* MOBILE STYLES */
@media screen and (max-width: 768px) {
  .product-enterprise {
    padding-top: 0 !important;
  }
  
  .product-hero {
    padding: 0 !important;
    margin-bottom: 32px;
  }
  
  .hero-container {
    grid-template-columns: 1fr;
    gap: 0;
  }
  
  .hero-image-section {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100vw !important;
    height: 100%;
    z-index: 1;
  }
  
  .hero-image-wrapper {
    border-radius: 0 !important;
    border: none !important;
    width: 100vw !important;
    height: 100%;
    box-shadow: none !important;
  }
  
  .hero-info-section {
    position: relative;
    z-index: 4;
    padding: 60px 20px 40px !important;
  }
  
  .product-flag {
    width: 48px;
    height: 48px;
    border-radius: 50%;
  }
  
  .product-title {
    font-size: 28px;
  }
  
  .trust-badges {
    display: none !important;
  }
  
  .product-selection {
    padding: 0 20px 80px !important;
  }
  
  .selection-grid {
    grid-template-columns: 1fr;
  }
  
  .purchase-box {
    display: none !important;
  }
  
  .plan-card {
    padding: 24px 20px;
    border-radius: 20px;
    margin-bottom: 16px !important;
  }
  
  /* Mobile Sticky Cart */
  .sticky-cart {
    display: block;
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: var(--product-card-bg);
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.15);
    z-index: 1000;
    padding: 10px 16px;
    transform: translateY(100%);
    transition: transform 0.3s ease;
    border-top: 1px solid var(--product-border);
  }
  
  [data-theme="dark"] .sticky-cart {
    background: #1a1a1a;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.3);
  }
  
  .sticky-cart.active {
    transform: translateY(0);
  }
  
  .sticky-cart-header {
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    padding: 5px 0;
  }
  
  .sticky-cart-menu {
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
  }
  
  .sticky-cart-menu button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;
    cursor: pointer;
    color: var(--product-text);
    padding: 8px;
  }
  
  .sticky-cart-title {
    font-size: 16px;
    font-weight: 700;
    color: var(--product-text);
  }
  
  .sticky-cart-button {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    background: linear-gradient(135deg, var(--product-primary), var(--product-accent));
    border-radius: 100px;
    padding: 17px 24px;
    color: white;
    font-weight: 700;
    font-size: 16px;
    gap: 10px;
    margin-top: 10px;
    border: none;
    cursor: pointer;
    box-shadow: 0 8px 24px rgba(0, 154, 97, 0.25);
  }
  
  .sticky-cart-button:active {
    transform: scale(0.98);
  }
}
</style>

<!-- Product Page HTML -->
<section class="product-enterprise" data-product-id="{{ product.id }}">
  
  <!-- Hero Section -->
  <div class="product-hero">
    <div class="hero-container">
      
      <div class="hero-image-section">
        <div class="hero-image-wrapper">
          {% if product.images[1] %}
            {{ product.images[1] | image_url: width: 800 | image_tag: 
               class: 'hero-image',
               loading: 'eager',
               alt: product.title }}
          {% else %}
            {{ product.featured_image | image_url: width: 800 | image_tag: 
               class: 'hero-image',
               loading: 'eager',
               alt: product.title }}
          {% endif %}
        </div>
      </div>
      
      <div class="hero-info-section">
        <div class="product-title-wrapper">
          {% if product.featured_image %}
            {{ product.featured_image | image_url: width: 80 | image_tag: 
               class: 'product-flag',
               alt: product.title }}
          {% endif %}
          
          <h1 class="product-title">
            {% assign title_parts = product.title | split: ' ' %}
            <span class="country-name">{{ title_parts[0] }}</span>
            <span class="esim-text">eSIM</span>
          </h1>
        </div>
        
        <p class="hero-subtitle">
          {{ 'product.hero_subtitle' | t | default: 'Prepaid eSIM data plans. Activated in 60 seconds, no contract.' }}
        </p>
        
        <div class="hero-features">
          <div class="hero-feature">
            <div class="hero-feature-icon">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <span>Instant delivery</span>
          </div>
          <div class="hero-feature">
            <div class="hero-feature-icon">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z" />
              </svg>
            </div>
            <span>Premium 4G/5G</span>
          </div>
          <div class="hero-feature">
            <div class="hero-feature-icon">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 01-2.555-.337A5.972 5.972 0 015.41 20.97a5.969 5.969 0 01-.474-.065 4.48 4.48 0 00.978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25z" />
              </svg>
            </div>
            <span>24/7 Support</span>
          </div>
        </div>
        
        <div class="trust-badges">
          <div class="trust-badge">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z" />
            </svg>
            <span>Money-back guarantee</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Product Selection -->
  <div class="product-selection">
    
    <!-- Check for unlimited variants -->
    {% assign has_unlimited = false %}
    {% for variant in product.variants %}
      {% if variant.sku contains 'daily' or variant.sku contains 'unlimited' %}
        {% assign has_unlimited = true %}
      {% endif %}
    {% endfor %}
    
    {% if has_unlimited %}
      <div class="variant-tabs">
        <button class="variant-tab active" data-tab="normal">
          <svg class="tab-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375" />
          </svg>
          <span>Data Plans</span>
        </button>
        <button class="variant-tab" data-tab="unlimited">
          <svg class="tab-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M9.5 12c0 1.657-1.343 3-3 3s-3-1.343-3-3 1.343-3 3-3 3 1.343 3 3zM14.5 12c0-1.657 1.343-3 3-3s3 1.343 3 3-1.343 3-3 3-3-1.343-3-3z"/>
            <path d="M9.5 12h5"/>
          </svg>
          <span>Unlimited Daily</span>
        </button>
      </div>
    {% endif %}
    
    <div class="selection-grid">
      
      <div class="plans-container">
        
        <!-- Normal Variants -->
        <div class="variant-group" id="normal-variants">
          {% assign variant_index = 0 %}
          {% for variant in product.variants %}
            {% unless variant.sku contains 'daily' or variant.sku contains 'unlimited' %}
              {% assign variant_index = variant_index | plus: 1 %}
              {% assign is_free = false %}
              {% if variant.price == 0 or variant.title contains '100MB' %}
                {% assign is_free = true %}
              {% endif %}
              
              <div class="plan-card {% if variant_index == 1 and is_free == false %}selected{% endif %}" 
                   data-variant-id="{{ variant.id }}" 
                   data-is-free="{{ is_free }}"
                   data-fingerprint="">
                
                {% if is_free %}
                  <span class="free-badge">FREE</span>
                {% endif %}
                
                {% if variant_index == 3 %}
                  <span class="popular-badge">POPULAR</span>
                {% endif %}
                
                <input type="radio" 
                       name="variant" 
                       value="{{ variant.id }}"
                       data-price="{% if is_free %}FREE{% else %}{{ variant.price | money }}{% endif %}"
                       data-title="{{ variant.title }}"
                       {% if variant_index == 1 and is_free == false %}checked{% endif %}
                       style="display: none;">
                
                <div class="plan-content">
                  <div class="plan-info">
                    <div class="plan-name">
                      {% if is_free %}
                        100MB Free eSIM
                      {% else %}
                        {{ variant.title }}
                      {% endif %}
                    </div>
                    <div class="plan-validity">
                      Valid for 7 days
                    </div>
                  </div>
                  <div class="plan-price-wrapper">
                    {% if is_free %}
                      {% if customer %}
                        <form action="/cart/add" method="post" class="free-form">
                          <input type="hidden" name="id" value="{{ variant.id }}">
                          <button type="submit" class="free-login-button">
                            Get FREE eSIM
                          </button>
                        </form>
                      {% else %}
                        <a href="/account/login?checkout_url=/cart/{{ variant.id }}:1" 
                           class="free-login-button">
                          Login for FREE
                        </a>
                      {% endif %}
                    {% else %}
                      <span class="plan-price">{{ variant.price | money }}</span>
                    {% endif %}
                  </div>
                </div>
              </div>
            {% endunless %}
          {% endfor %}
        </div>
        
        <!-- Unlimited Variants -->
        {% if has_unlimited %}
          <div class="variant-group" id="unlimited-variants" style="display: none;">
            {% for variant in product.variants %}
              {% if variant.sku contains 'daily' or variant.sku contains 'unlimited' %}
                <div class="plan-card" data-variant-id="{{ variant.id }}">
                  <input type="radio" 
                         name="variant" 
                         value="{{ variant.id }}"
                         data-price="{{ variant.price | money }}"
                         data-title="{{ variant.title }}"
                         style="display: none;">
                  
                  <div class="plan-content">
                    <div class="plan-info">
                      <div class="plan-name">{{ variant.title }}</div>
                      <div class="plan-validity">1GB/day</div>
                    </div>
                    <div class="plan-price-wrapper">
                      <span class="plan-price">{{ variant.price | money }}</span>
                    </div>
                  </div>
                </div>
              {% endif %}
            {% endfor %}
          </div>
        {% endif %}
      </div>
      
      <!-- Purchase Box -->
      <div class="purchase-box">
        <h3 class="purchase-title">Your Selection</h3>
        
        <div class="summary-box">
          <div class="summary-row">
            <span class="summary-label">{{ product.title }} eSIM</span>
            <span class="summary-value" id="selected-variant">-</span>
          </div>
          <div class="summary-row">
            <span class="summary-label">Network</span>
            <span class="summary-value">{{ product.metafields.custom.plantyp | default: 'Premium' }}</span>
          </div>
          <div class="summary-row">
            <span class="summary-label">Total</span>
            <span class="summary-value" id="total-price">-</span>
          </div>
        </div>
        
        <form action="/cart/add" method="post" id="product-form">
          <input type="hidden" name="id" id="variant-input" value="">
          <button type="submit" class="checkout-button">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 20px; height: 20px;">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />
            </svg>
            <span>Buy Now</span>
          </button>
        </form>
        
        <div class="payment-methods">
          {{ 'visa' | payment_type_svg_tag: class: 'payment-method' }}
          {{ 'master' | payment_type_svg_tag: class: 'payment-method' }}
          {{ 'apple_pay' | payment_type_svg_tag: class: 'payment-method' }}
        </div>
      </div>
    </div>
  </div>
  
  <!-- Mobile Sticky Cart -->
  <div class="sticky-cart" id="sticky-cart">
    <div class="sticky-cart-header">
      <div class="sticky-cart-title" id="sticky-title">-</div>
      <div class="sticky-cart-menu">
        <button type="button" id="open-mobile-menu" aria-label="Open menu">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="24" height="24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
          </svg>
        </button>
      </div>
    </div>
    <button class="sticky-cart-button" id="sticky-button">
      Buy Now
    </button>
  </div>
</section>

<script>
(function() {
  'use strict';
  
  const section = document.querySelector('.product-enterprise');
  const planCards = section.querySelectorAll('.plan-card');
  const variantInput = section.querySelector('#variant-input');
  const selectedVariantText = section.querySelector('#selected-variant');
  const totalPriceText = section.querySelector('#total-price');
  const productForm = section.querySelector('#product-form');
  const stickyCart = document.querySelector('#sticky-cart');
  const stickyTitle = document.querySelector('#sticky-title');
  const stickyButton = document.querySelector('#sticky-button');
  const openMobileMenuBtn = document.querySelector('#open-mobile-menu');
  
  let currentVariant = null;
  const isCustomerLoggedIn = {{ customer.id | default: 'null' }} !== null;
  const customerId = {{ customer.id | default: 'null' }};
  
  // Browser Fingerprint
  function generateFingerprint() {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    ctx.textBaseline = 'top';
    ctx.font = '14px Arial';
    ctx.textBaseline = 'alphabetic';
    ctx.fillStyle = '#f60';
    ctx.fillRect(125, 1, 62, 20);
    ctx.fillStyle = '#069';
    ctx.fillText('Simbye', 2, 15);
    
    const fingerprint = canvas.toDataURL();
    const screen = `${window.screen.width}x${window.screen.height}`;
    const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
    const lang = navigator.language;
    const platform = navigator.platform;
    
    return btoa(`${fingerprint}|${screen}|${timezone}|${lang}|${platform}`).substring(0, 32);
  }
  
  const deviceFingerprint = generateFingerprint();
  
  // Check FREE eSIM bereits gekauft
  function checkFreePurchase() {
    const freePurchases = JSON.parse(localStorage.getItem('simbye_free_purchases') || '[]');
    const freeCard = section.querySelector('.plan-card[data-is-free="true"]');
    
    if (!freeCard) return;
    
    // Check Customer ID
    if (isCustomerLoggedIn && freePurchases.includes(`customer_${customerId}`)) {
      freeCard.classList.add('already-claimed');
      return true;
    }
    
    // Check Fingerprint
    if (freePurchases.includes(`fp_${deviceFingerprint}`)) {
      freeCard.classList.add('already-claimed');
      return true;
    }
    
    return false;
  }
  
  // Mark FREE as purchased
  function markFreePurchased() {
    const freePurchases = JSON.parse(localStorage.getItem('simbye_free_purchases') || '[]');
    
    if (isCustomerLoggedIn) {
      freePurchases.push(`customer_${customerId}`);
    }
    freePurchases.push(`fp_${deviceFingerprint}`);
    
    localStorage.setItem('simbye_free_purchases', JSON.stringify([...new Set(freePurchases)]));
  }
  
  // Initialize
  checkFreePurchase();
  
  // Variant Tabs
  const variantTabs = section.querySelectorAll('.variant-tab');
  const normalGroup = section.querySelector('#normal-variants');
  const unlimitedGroup = section.querySelector('#unlimited-variants');
  
  if (variantTabs.length > 0) {
    variantTabs.forEach(tab => {
      tab.addEventListener('click', function() {
        variantTabs.forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        
        const tabType = this.dataset.tab;
        
        if (tabType === 'unlimited') {
          if (normalGroup) normalGroup.style.display = 'none';
          if (unlimitedGroup) unlimitedGroup.style.display = 'block';
        } else {
          if (normalGroup) normalGroup.style.display = 'block';
          if (unlimitedGroup) unlimitedGroup.style.display = 'none';
        }
        
        const activeGroup = tabType === 'unlimited' ? unlimitedGroup : normalGroup;
        const firstCard = activeGroup?.querySelector('.plan-card:not([data-is-free="true"])');
        if (firstCard) selectPlan(firstCard);
      });
    });
  }
  
  // Select Plan
  function selectPlan(card) {
    const isFree = card.dataset.isFree === 'true';
    if (isFree) return; // FREE cards haben eigene Logik
    
    planCards.forEach(c => c.classList.remove('selected'));
    card.classList.add('selected');
    
    const radio = card.querySelector('input[type="radio"]');
    if (radio) {
      radio.checked = true;
      currentVariant = {
        id: radio.value,
        price: radio.dataset.price,
        title: radio.dataset.title
      };
      
      variantInput.value = currentVariant.id;
      selectedVariantText.textContent = currentVariant.title;
      totalPriceText.textContent = currentVariant.price;
      
      if (stickyCart) {
        stickyTitle.textContent = currentVariant.title + ' - ' + currentVariant.price;
      }
    }
  }
  
  // Plan Card Clicks
  planCards.forEach(card => {
    card.addEventListener('click', function(e) {
      if (e.target.closest('a') || e.target.closest('form') || e.target.closest('button')) {
        return;
      }
      selectPlan(this);
    });
  });
  
  // FREE Form Submission
  const freeForms = section.querySelectorAll('.free-form');
  freeForms.forEach(form => {
    form.addEventListener('submit', function(e) {
      if (checkFreePurchase()) {
        e.preventDefault();
        alert('You have already claimed your FREE eSIM. Each customer can only get one FREE eSIM.');
        return;
      }
      markFreePurchased();
    });
  });
  
  // Product Form
  productForm.addEventListener('submit', function(e) {
    if (!currentVariant) {
      e.preventDefault();
      alert('Please select a plan');
      return;
    }
  });
  
  // Mobile Sticky Cart Scroll
  let ticking = false;
  window.addEventListener('scroll', function() {
    if (!ticking && window.innerWidth <= 768) {
      window.requestAnimationFrame(function() {
        const selectionTop = section.querySelector('.product-selection')?.offsetTop || 0;
        const scrolled = window.scrollY > selectionTop - 200;
        
        if (stickyCart) {
          stickyCart.classList.toggle('active', scrolled);
        }
        
        ticking = false;
      });
      ticking = true;
    }
  });
  
  // Sticky Button - FIXED: Trigger echtes Submit
  if (stickyButton) {
    stickyButton.addEventListener('click', function(e) {
      e.preventDefault();
      if (currentVariant && productForm) {
        productForm.submit(); // ECHTES Submit, nicht nur Event
      } else {
        alert('Please select a plan');
      }
    });
  }
  
  // Open Mobile Menu from Sticky Cart - FIXED
  if (openMobileMenuBtn) {
    openMobileMenuBtn.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      // Trigger Header Mobile Toggle
      const mobileToggle = document.getElementById('mobile-toggle');
      if (mobileToggle) {
        mobileToggle.click();
      }
    });
  }
  
  // Initialize first variant
  const firstCard = section.querySelector('.plan-card:not([data-is-free="true"])');
  if (firstCard) selectPlan(firstCard);
})();
</script>

{% schema %}
{
  "name": "Product Page",
  "settings": []
}
{% endschema %}