<!-- sections/product-enterprise.liquid -->
<!-- SIMBYE ENTERPRISE PRODUCT PAGE V4.0 - COMPLETE REDESIGN -->

<style>
/* ============================================
   ENTERPRISE PRODUCT PAGE V4 - SIMBYE ESIM
   ============================================ */

:root {
  --product-primary: #009a61;
  --product-primary-dark: #00824f;
  --product-accent: #00d97e;
  --product-text: #1a1a1a;
  --product-text-secondary: #666;
  --product-bg: #ffffff;
  --product-card-bg: #ffffff;
  --product-border: rgba(0, 0, 0, 0.06);
  --product-shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.04);
  --product-shadow-md: 0 8px 24px rgba(0, 0, 0, 0.08);
  --product-shadow-lg: 0 16px 48px rgba(0, 154, 97, 0.12);
  --product-radius: 24px;
  --product-radius-sm: 16px;
  --product-transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Dark Mode Variables */
[data-theme="dark"] {
  --product-text: #ffffff;
  --product-text-secondary: #a0a0a0;
  --product-bg: #0a0a0a;
  --product-card-bg: rgba(255, 255, 255, 0.03);
  --product-border: rgba(255, 255, 255, 0.08);
  --product-primary: #00d97e;
  --product-primary-dark: #00c571;
  --product-shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.2);
  --product-shadow-md: 0 8px 24px rgba(0, 0, 0, 0.3);
  --product-shadow-lg: 0 16px 48px rgba(0, 217, 126, 0.15);
}

/* Section Base - FULL WIDTH */
.product-enterprise {
  width: 100%;
  background: var(--product-bg);
  position: relative;
  overflow: hidden;
  padding-top: 60px;
}

/* Dark Mode Background - Nahtloser √úbergang */
[data-theme="dark"] .product-enterprise {
  background: linear-gradient(180deg,
    #0a0a0a 0%,
    #0b0b0b 50%,
    #0a0a0a 100%
  );
}

/* Hero Section */
.product-hero {
  max-width: 1440px;
  margin: 0 auto;
  padding: 0 40px 60px;
}

.hero-container {
  display: grid;
  grid-template-columns: 1.2fr 1fr;
  gap: 60px;
  align-items: center;
}

/* Hero Image (LEFT) - OHNE Premium Badge */
.hero-image-section {
  order: 1;
  position: relative;
  animation: fadeInLeft 0.8s ease;
}

@keyframes fadeInLeft {
  from { opacity: 0; transform: translateX(-30px); }
  to { opacity: 1; transform: translateX(0); }
}

.hero-image-wrapper {
  position: relative;
  border-radius: var(--product-radius);
  overflow: hidden;
  box-shadow: var(--product-shadow-lg);
  aspect-ratio: 16/10;
  background: var(--product-card-bg);
}

.hero-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Hero Info (RIGHT) */
.hero-info-section {
  order: 2;
  animation: fadeInRight 0.8s ease 0.1s both;
}

@keyframes fadeInRight {
  from { opacity: 0; transform: translateX(30px); }
  to { opacity: 1; transform: translateX(0); }
}

.product-title-wrapper {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 20px;
}

.product-flag {
  width: 56px;
  height: 42px;
  border-radius: 12px;
  object-fit: cover;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.product-title {
  font-size: clamp(36px, 4vw, 48px);
  font-weight: 800;
  line-height: 1.1;
  color: var(--product-text);
  margin: 0;
  letter-spacing: -0.02em;
}

.price-range {
  display: inline-flex;
  align-items: baseline;
  gap: 8px;
  background: linear-gradient(135deg, var(--product-primary), var(--product-accent));
  color: white;
  padding: 12px 24px;
  border-radius: 100px;
  font-size: 24px;
  font-weight: 700;
  margin-bottom: 24px;
  box-shadow: 0 8px 24px rgba(0, 154, 97, 0.25);
}

.price-from {
  font-size: 14px;
  opacity: 0.9;
}

.hero-subtitle {
  font-size: 18px;
  color: var(--product-text-secondary);
  line-height: 1.6;
  margin-bottom: 32px;
}

.hero-features {
  display: flex;
  flex-direction: column;
  gap: 16px;
  margin-bottom: 32px;
}

.hero-feature {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 16px;
  color: var(--product-text);
}

.hero-feature svg {
  width: 24px;
  height: 24px;
  color: var(--product-primary);
  flex-shrink: 0;
}

/* Trust Badges */
.trust-badges {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
}

.trust-badge {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  background: var(--product-card-bg);
  border: 1px solid var(--product-border);
  border-radius: 100px;
  font-size: 14px;
  font-weight: 600;
  color: var(--product-text);
}

.trust-badge svg {
  width: 20px;
  height: 20px;
  color: var(--product-primary);
}

/* Product Selection Section */
.product-selection {
  max-width: 1440px;
  margin: 0 auto;
  padding: 0 40px 60px;
}

/* IMPROVED Tab System */
.variant-tabs {
  display: flex;
  gap: 4px;
  background: var(--product-card-bg);
  padding: 4px;
  border-radius: var(--product-radius-sm);
  border: 1px solid var(--product-border);
  margin-bottom: 32px;
  box-shadow: var(--product-shadow-sm);
}

.variant-tab {
  flex: 1;
  padding: 16px 32px;
  background: transparent;
  border: none;
  border-radius: 12px;
  font-size: 18px;
  font-weight: 600;
  color: var(--product-text-secondary);
  cursor: pointer;
  transition: var(--product-transition);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  font-family: inherit;
}

.variant-tab:hover {
  background: rgba(0, 154, 97, 0.05);
  color: var(--product-text);
}

.variant-tab.active {
  background: var(--product-primary);
  color: white;
  box-shadow: 0 4px 12px rgba(0, 154, 97, 0.3);
}

.variant-tab svg {
  width: 20px;
  height: 20px;
}

/* Fair Use Notice */
.fair-use-notice {
  background: linear-gradient(135deg, 
    rgba(0, 154, 97, 0.05) 0%, 
    rgba(0, 217, 126, 0.05) 100%);
  border: 2px solid var(--product-primary);
  border-radius: var(--product-radius-sm);
  padding: 24px;
  margin-bottom: 32px;
  display: none;
  animation: slideDown 0.3s ease;
}

.fair-use-notice.active {
  display: block;
}

@keyframes slideDown {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

.fair-use-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
}

.fair-use-title {
  font-size: 18px;
  font-weight: 700;
  color: var(--product-primary);
  margin: 0;
}

.fair-use-text {
  font-size: 15px;
  color: var(--product-text-secondary);
  line-height: 1.6;
  margin: 0;
}

/* Selection Grid - NO YOUR SELECTION ON MOBILE */
.selection-grid {
  display: grid;
  grid-template-columns: 1.5fr 1fr;
  gap: 40px;
}

/* Plans Container */
.plans-container {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.variant-group {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

/* IMPROVED Plan Card Design */
.plan-card {
  position: relative;
  background: var(--product-card-bg);
  border: 2px solid var(--product-border);
  border-radius: var(--product-radius-sm);
  padding: 28px;
  cursor: pointer;
  transition: var(--product-transition);
  overflow: hidden;
}

.plan-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--product-primary), var(--product-accent));
  opacity: 0;
  transition: opacity 0.3s ease;
}

.plan-card:hover {
  border-color: var(--product-primary);
  transform: translateY(-4px);
  box-shadow: var(--product-shadow-md);
}

.plan-card:hover::before {
  opacity: 1;
}

.plan-card.selected {
  border-color: var(--product-primary);
  background: linear-gradient(135deg, 
    rgba(0, 154, 97, 0.03) 0%, 
    rgba(0, 217, 126, 0.03) 100%);
  box-shadow: 0 8px 24px rgba(0, 154, 97, 0.15);
}

.plan-card.selected::before {
  opacity: 1;
}

.plan-card input[type="radio"] {
  position: absolute;
  opacity: 0;
  pointer-events: none;
}

.plan-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.plan-info {
  flex: 1;
}

.plan-name {
  font-size: 22px;
  font-weight: 700;
  color: var(--product-text);
  margin-bottom: 6px;
}

.plan-validity {
  font-size: 14px;
  color: var(--product-text-secondary);
}

.plan-price-wrapper {
  text-align: right;
}

.plan-price {
  font-size: 32px;
  font-weight: 800;
  color: var(--product-primary);
  letter-spacing: -0.02em;
}

.plan-price-old {
  font-size: 18px;
  color: var(--product-text-secondary);
  text-decoration: line-through;
  display: block;
  margin-bottom: 4px;
}

/* Popular Badge - ANIMATED */
.popular-badge {
  position: absolute;
  top: -12px;
  right: 20px;
  background: linear-gradient(135deg, #ff7e50, #ff9a76);
  color: white;
  padding: 6px 16px;
  border-radius: 100px;
  font-size: 12px;
  font-weight: 700;
  text-transform: uppercase;
  box-shadow: 0 4px 12px rgba(255, 126, 80, 0.3);
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

/* FREE Badge - PROMINENT */
.free-badge {
  position: absolute;
  top: 50%;
  right: 24px;
  transform: translateY(-50%);
  background: linear-gradient(135deg, var(--product-accent), #00ff88);
  color: #0a0a0a;
  padding: 8px 20px;
  border-radius: 100px;
  font-weight: 800;
  font-size: 16px;
  box-shadow: 0 6px 20px rgba(0, 217, 126, 0.4);
  animation: freePulse 1.5s infinite;
  display: flex;
  align-items: center;
  gap: 6px;
}

@keyframes freePulse {
  0%, 100% { 
    transform: translateY(-50%) scale(1);
    box-shadow: 0 6px 20px rgba(0, 217, 126, 0.4);
  }
  50% { 
    transform: translateY(-50%) scale(1.08);
    box-shadow: 0 8px 28px rgba(0, 217, 126, 0.6);
  }
}

.free-badge::before {
  content: 'üéÅ';
  font-size: 18px;
}

/* Login Overlay */
.login-overlay {
  position: absolute;
  inset: 0;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--product-radius-sm);
  z-index: 10;
}

[data-theme="dark"] .login-overlay {
  background: rgba(0, 0, 0, 0.95);
}

.login-button {
  background: linear-gradient(135deg, var(--product-primary), var(--product-accent));
  color: white;
  padding: 14px 32px;
  border-radius: 100px;
  font-weight: 700;
  font-size: 16px;
  text-decoration: none;
  transition: var(--product-transition);
  box-shadow: 0 8px 24px rgba(0, 154, 97, 0.25);
}

.login-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 32px rgba(0, 154, 97, 0.35);
}

/* Purchase Box - DESKTOP ONLY */
.purchase-box {
  position: sticky;
  top: 100px;
  background: var(--product-card-bg);
  border: 1px solid var(--product-border);
  border-radius: var(--product-radius);
  padding: 32px;
  box-shadow: var(--product-shadow-md);
}

.purchase-title {
  font-size: 24px;
  font-weight: 700;
  color: var(--product-text);
  margin-bottom: 24px;
}

.summary-box {
  background: linear-gradient(135deg, 
    rgba(0, 154, 97, 0.05) 0%, 
    rgba(0, 217, 126, 0.05) 100%);
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 24px;
}

.summary-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
}

.summary-row:not(:last-child) {
  border-bottom: 1px solid var(--product-border);
}

.summary-label {
  font-size: 14px;
  color: var(--product-text-secondary);
}

.summary-value {
  font-size: 16px;
  font-weight: 600;
  color: var(--product-text);
}

.summary-row:last-child .summary-label,
.summary-row:last-child .summary-value {
  font-size: 18px;
  font-weight: 700;
  color: var(--product-primary);
}

/* Checkout Button */
.checkout-form {
  margin-bottom: 20px;
}

.checkout-button {
  width: 100%;
  background: linear-gradient(135deg, var(--product-primary), var(--product-accent));
  color: white;
  border: none;
  border-radius: 12px;
  padding: 18px;
  font-size: 18px;
  font-weight: 700;
  cursor: pointer;
  transition: var(--product-transition);
  box-shadow: 0 8px 24px rgba(0, 154, 97, 0.25);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
}

.checkout-button:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 12px 32px rgba(0, 154, 97, 0.35);
}

.checkout-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.checkout-button svg {
  width: 20px;
  height: 20px;
}

/* Payment Methods */
.payment-methods {
  display: flex;
  justify-content: center;
  gap: 8px;
  padding-top: 20px;
  border-top: 1px solid var(--product-border);
}

.payment-method {
  height: 24px;
  opacity: 0.7;
  transition: var(--product-transition);
}

.payment-method:hover {
  opacity: 1;
  transform: scale(1.05);
}

/* Product Details Section - NEW */
.product-details {
  max-width: 1440px;
  margin: 0 auto;
  padding: 60px 40px;
  border-top: 1px solid var(--product-border);
}

.details-tabs {
  display: flex;
  gap: 4px;
  background: var(--product-card-bg);
  padding: 4px;
  border-radius: var(--product-radius-sm);
  border: 1px solid var(--product-border);
  margin-bottom: 40px;
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
}

.details-tab {
  flex: 1;
  padding: 14px 24px;
  background: transparent;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  color: var(--product-text-secondary);
  cursor: pointer;
  transition: var(--product-transition);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  font-family: inherit;
}

.details-tab:hover {
  background: rgba(0, 154, 97, 0.05);
  color: var(--product-text);
}

.details-tab.active {
  background: var(--product-primary);
  color: white;
}

.details-tab svg {
  width: 18px;
  height: 18px;
}

.details-content {
  position: relative;
}

.details-panel {
  display: none;
  animation: fadeIn 0.3s ease;
}

.details-panel.active {
  display: block;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Description Panel */
.description-features {
  margin-bottom: 48px;
}

.description-title {
  font-size: 28px;
  font-weight: 700;
  color: var(--product-text);
  margin-bottom: 32px;
  text-align: center;
}

.feature-list {
  display: grid;
  gap: 24px;
  max-width: 800px;
  margin: 0 auto;
}

.feature-item {
  display: flex;
  gap: 20px;
  padding: 24px;
  background: var(--product-card-bg);
  border: 1px solid var(--product-border);
  border-radius: var(--product-radius-sm);
  transition: var(--product-transition);
}

.feature-item:hover {
  transform: translateX(8px);
  box-shadow: var(--product-shadow-md);
  border-color: var(--product-primary);
}

.feature-icon-wrapper {
  flex-shrink: 0;
  width: 48px;
  height: 48px;
  background: linear-gradient(135deg, var(--product-primary), var(--product-accent));
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
}

.feature-icon-wrapper svg {
  width: 24px;
  height: 24px;
}

.feature-content {
  flex: 1;
}

.feature-content strong {
  display: block;
  font-size: 18px;
  color: var(--product-text);
  margin-bottom: 8px;
}

.feature-content p {
  font-size: 15px;
  color: var(--product-text-secondary);
  line-height: 1.6;
  margin: 0;
}

/* Technical Specs Grid */
.specs-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20px;
  max-width: 800px;
  margin: 0 auto;
}

.spec-item {
  display: flex;
  padding: 16px 20px;
  background: var(--product-card-bg);
  border: 1px solid var(--product-border);
  border-radius: 12px;
  transition: var(--product-transition);
}

.spec-item:hover {
  background: linear-gradient(135deg,
    rgba(0, 154, 97, 0.03) 0%,
    rgba(0, 217, 126, 0.03) 100%);
  border-color: var(--product-primary);
}

.spec-label {
  font-size: 14px;
  color: var(--product-text-secondary);
  font-weight: 600;
  min-width: 140px;
}

.spec-value {
  font-size: 14px;
  color: var(--product-text);
  font-weight: 500;
}

/* Features Section */
.features-section {
  max-width: 1440px;
  margin: 0 auto;
  padding: 60px 40px;
  border-top: 1px solid var(--product-border);
}

.features-title {
  font-size: clamp(32px, 4vw, 40px);
  font-weight: 700;
  text-align: center;
  margin-bottom: 48px;
  color: var(--product-text);
}

.features-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 32px;
}

.feature-card {
  text-align: center;
  padding: 40px 24px;
  background: var(--product-card-bg);
  border: 1px solid var(--product-border);
  border-radius: var(--product-radius);
  transition: var(--product-transition);
  animation: fadeInUp 0.8s ease both;
  animation-delay: calc(var(--index) * 0.1s);
}

.feature-card:nth-child(1) { --index: 0; }
.feature-card:nth-child(2) { --index: 1; }
.feature-card:nth-child(3) { --index: 2; }

@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

.feature-card:hover {
  transform: translateY(-4px);
  box-shadow: var(--product-shadow-md);
  border-color: var(--product-primary);
}

.feature-icon {
  width: 72px;
  height: 72px;
  background: linear-gradient(135deg, var(--product-primary), var(--product-accent));
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 24px;
  color: white;
}

.feature-icon svg {
  width: 36px;
  height: 36px;
}

.feature-name {
  font-size: 22px;
  font-weight: 700;
  margin-bottom: 12px;
  color: var(--product-text);
}

.feature-desc {
  font-size: 15px;
  color: var(--product-text-secondary);
  line-height: 1.6;
}

/* Mobile Sticky Cart - NEW DESIGN */
.mobile-sticky {
  display: none;
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-top: 1px solid var(--product-border);
  padding: 12px 16px;
  z-index: 1000;
  transform: translateY(100%);
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.1);
}

[data-theme="dark"] .mobile-sticky {
  background: rgba(10, 10, 10, 0.95);
}

.mobile-sticky.active {
  transform: translateY(0);
}

.sticky-container {
  display: flex;
  align-items: center;
  gap: 12px;
  max-width: 500px;
  margin: 0 auto;
}

.sticky-info {
  flex: 1;
}

.sticky-title {
  font-size: 13px;
  color: var(--product-text-secondary);
  margin-bottom: 2px;
}

.sticky-price {
  font-size: 22px;
  font-weight: 800;
  color: var(--product-primary);
  letter-spacing: -0.02em;
}

.sticky-button {
  background: linear-gradient(135deg, var(--product-primary), var(--product-accent));
  color: white;
  border: none;
  border-radius: 100px;
  padding: 14px 28px;
  font-size: 16px;
  font-weight: 700;
  white-space: nowrap;
  transition: var(--product-transition);
  cursor: pointer;
  box-shadow: 0 4px 16px rgba(0, 154, 97, 0.3);
}

.sticky-button:active {
  transform: scale(0.98);
}

/* MOBILE OPTIMIZATIONS - FULL WIDTH */
@media (max-width: 768px) {
  .product-enterprise {
    padding-top: 20px;
  }
  
  /* Hero FULL WIDTH */
  .product-hero {
    padding: 0;
  }
  
  .hero-container {
    grid-template-columns: 1fr;
    gap: 0;
  }
  
  /* Image EDGE TO EDGE */
  .hero-image-section {
    order: 1;
    margin: 0;
    padding: 0;
    animation: none;
  }
  
  .hero-image-wrapper {
    border-radius: 0;
    width: 100vw;
    margin: 0;
    box-shadow: none;
    aspect-ratio: 4/3;
  }
  
  /* Info with Padding */
  .hero-info-section {
    order: 2;
    padding: 24px 20px 32px;
    text-align: center;
    animation: none;
  }
  
  .product-title-wrapper {
    justify-content: center;
  }
  
  .product-title {
    font-size: 32px;
  }
  
  .price-range {
    font-size: 20px;
    padding: 10px 20px;
  }
  
  .hero-subtitle {
    font-size: 16px;
  }
  
  .trust-badges {
    justify-content: center;
  }
  
  /* Selection */
  .product-selection {
    padding: 0 20px 40px;
  }
  
  /* REMOVE YOUR SELECTION ON MOBILE */
  .selection-grid {
    grid-template-columns: 1fr;
    gap: 24px;
  }
  
  .purchase-box {
    display: none; /* HIDE ON MOBILE */
  }
  
  /* Show Sticky Instead */
  .mobile-sticky {
    display: block;
  }
  
  /* Tabs Mobile */
  .variant-tabs {
    gap: 2px;
    padding: 2px;
    margin-bottom: 24px;
  }
  
  .variant-tab {
    padding: 12px 16px;
    font-size: 15px;
  }
  
  .variant-tab svg {
    width: 18px;
    height: 18px;
  }
  
  /* Plan Cards Mobile */
  .plan-card {
    padding: 20px;
  }
  
  .plan-name {
    font-size: 18px;
  }
  
  .plan-price {
    font-size: 26px;
  }
  
  /* Product Details Mobile */
  .product-details {
    padding: 40px 20px;
  }
  
  .specs-grid {
    grid-template-columns: 1fr;
    gap: 12px;
  }
  
  /* Features Mobile */
  .features-section {
    padding: 40px 20px;
  }
  
  .features-grid {
    grid-template-columns: 1fr;
    gap: 24px;
  }
}

/* Very Small Screens */
@media (max-width: 480px) {
  .plan-card {
    padding: 16px;
  }
  
  .plan-name {
    font-size: 16px;
  }
  
  .plan-price {
    font-size: 24px;
  }
  
  .variant-tab {
    padding: 10px 12px;
    font-size: 14px;
  }
}

/* Dark Mode Specific Fixes */
[data-theme="dark"] .plan-card {
  background: rgba(26, 26, 26, 0.6);
  border-color: rgba(255, 255, 255, 0.08);
}

[data-theme="dark"] .plan-card:hover {
  background: rgba(26, 26, 26, 0.8);
  border-color: var(--product-primary);
}

[data-theme="dark"] .feature-item {
  background: rgba(26, 26, 26, 0.5);
  border-color: rgba(255, 255, 255, 0.06);
}

[data-theme="dark"] .spec-item {
  background: rgba(26, 26, 26, 0.4);
  border-color: rgba(255, 255, 255, 0.05);
}

/* Print Styles */
@media print {
  .mobile-sticky,
  .purchase-box,
  .variant-tabs {
    display: none !important;
  }
}
</style>

<!-- Product Page Structure -->
<section class="product-enterprise" data-product-id="{{ product.id }}">
  
  <!-- Hero Section -->
  <div class="product-hero">
    <div class="hero-container">
      
      <!-- Hero Image (LEFT) -->
      <div class="hero-image-section">
        <div class="hero-image-wrapper">
          {% if product.images[1] %}
            {{ product.images[1] | image_url: width: 800 | image_tag: 
               class: 'hero-image',
               loading: 'eager',
               fetchpriority: 'high',
               alt: product.title }}
          {% else %}
            {{ product.featured_image | image_url: width: 800 | image_tag: 
               class: 'hero-image',
               loading: 'eager',
               fetchpriority: 'high',
               alt: product.title }}
          {% endif %}
        </div>
      </div>
      
      <!-- Hero Info (RIGHT) -->
      <div class="hero-info-section">
        <div class="product-title-wrapper">
          {% comment %} Flag from metafield {% endcomment %}
          {% if product.metafields.custom.flag %}
            {{ product.metafields.custom.flag | image_url: width: 112 | image_tag: 
               class: 'product-flag',
               alt: product.title }}
          {% endif %}
          <h1 class="product-title">{{ product.title }} eSIM</h1>
        </div>
        
        <!-- Price Range -->
        <div class="price-range">
          <span class="price-from">{{ 'product.price_from' | t }}</span>
          <span>{{ product.price_min | money }} - {{ product.price_max | money }}</span>
        </div>
        
        <!-- Subtitle -->
        <p class="hero-subtitle">
          {{ 'product.hero_subtitle' | t: country: product.title }}
        </p>
        
        <!-- Features List -->
        <div class="hero-features">
          <div class="hero-feature">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <span>{{ 'product.instant_delivery' | t }}</span>
          </div>
          <div class="hero-feature">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
            <span>{{ 'product.premium_network' | t }}</span>
          </div>
          <div class="hero-feature">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
            </svg>
            <span>{{ 'product.whatsapp_support' | t }}</span>
          </div>
        </div>
        
        <!-- Trust Badges -->
        <div class="trust-badges">
          <div class="trust-badge">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <span>{{ 'product.money_back' | t }}</span>
          </div>
          <div class="trust-badge">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
            </svg>
            <span>{{ 'product.secure_payment' | t }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Product Selection -->
  <div class="product-selection">
    
    <!-- Check for variants -->
    {% assign has_unlimited = false %}
    {% assign has_free = false %}
    
    {% for variant in product.variants %}
      {% if variant.sku contains 'daily' or variant.sku contains 'Daily' %}
        {% assign has_unlimited = true %}
      {% endif %}
      {% if variant.price == 0 %}
        {% assign has_free = true %}
      {% endif %}
    {% endfor %}
    
    <!-- Tab System (only if unlimited exists) -->
    {% if has_unlimited %}
      <div class="variant-tabs">
        <button class="variant-tab active" data-tab="normal">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"/>
          </svg>
          <span>{{ 'product.data_plans' | t }}</span>
        </button>
        <button class="variant-tab" data-tab="unlimited">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12.75 4.75C10.5 4.75 8.75 6.5 8.75 8.75C8.75 11 10.5 12.75 12.75 12.75C13.5 12.75 14.25 12.5 14.75 12L19.25 16.5C19.75 17 19.75 17.75 19.25 18.25C18.75 18.75 18 18.75 17.5 18.25L13 13.75C12.5 14.25 11.75 14.5 11 14.5C8.75 14.5 7 12.75 7 10.5C7 8.25 8.75 6.5 11 6.5C11.75 6.5 12.5 6.75 13 7.25L17.5 11.75C18 12.25 18.75 12.25 19.25 11.75C19.75 11.25 19.75 10.5 19.25 10L14.75 5.5C14.25 5 13.5 4.75 12.75 4.75"/>
          </svg>
          <span>{{ 'product.unlimited_daily' | t }}</span>
        </button>
      </div>
      
      <!-- Fair Use Notice -->
      <div class="fair-use-notice" id="fair-use-notice">
        <div class="fair-use-header">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
          </svg>
          <h3 class="fair-use-title">{{ 'product.fair_use_title' | t }}</h3>
        </div>
        <p class="fair-use-text">{{ 'product.fair_use_text' | t }}</p>
      </div>
    {% endif %}
    
    <!-- Selection Grid -->
    <div class="selection-grid">
      
      <!-- Plans Container -->
      <div class="plans-container">
        
        <!-- Normal Variants -->
        <div class="variant-group" id="normal-variants" style="display: block;">
          {% assign variant_index = 0 %}
          {% for variant in product.variants %}
            {% unless variant.sku contains 'daily' or variant.sku contains 'Daily' %}
              {% assign variant_index = variant_index | plus: 1 %}
              {% assign is_free = false %}
              {% if variant.price == 0 %}
                {% assign is_free = true %}
              {% endif %}
              
              <div class="plan-card {% if variant_index == 1 %}selected{% endif %}" 
                   data-variant-id="{{ variant.id }}" 
                   data-is-free="{{ is_free }}">
                <input type="radio" 
                       name="variant" 
                       value="{{ variant.id }}"
                       data-price="{{ variant.price | money }}"
                       data-title="{{ variant.title }}"
                       {% if variant_index == 1 %}checked{% endif %}>
                
                <div class="plan-content">
                  <div class="plan-info">
                    <div class="plan-name">
                      {% if is_free %}
                        100MB {{ 'product.free' | t }}
                      {% else %}
                        {{ variant.title }}
                      {% endif %}
                    </div>
                    <div class="plan-validity">
                      {{ 'product.valid_for' | t }}
                      {% assign title_parts = variant.title | split: " " %}
                      {% assign days_index = title_parts.size | minus: 2 %}
                      {{ title_parts[days_index] }}
                      {{ 'product.days' | t }}
                    </div>
                  </div>
                  <div class="plan-price-wrapper">
                    {% if variant.compare_at_price > variant.price %}
                      <span class="plan-price-old">{{ variant.compare_at_price | money }}</span>
                    {% endif %}
                    <span class="plan-price">
                      {% if is_free %}
                        {{ 'product.free' | t }}
                      {% else %}
                        {{ variant.price | money }}
                      {% endif %}
                    </span>
                  </div>
                </div>
                
                {% if variant_index == 3 %}
                  <span class="popular-badge">{{ 'product.popular' | t }}</span>
                {% endif %}
                
                {% if is_free %}
                  <span class="free-badge">100MB FREE</span>
                  {% unless customer %}
                    <div class="login-overlay">
                      <a href="/account/login?return_url={{ request.path }}" class="login-button">
                        {{ 'product.login_for_free' | t }}
                      </a>
                    </div>
                  {% endunless %}
                {% endif %}
              </div>
            {% endunless %}
          {% endfor %}
        </div>
        
        <!-- Unlimited Variants -->
        {% if has_unlimited %}
          <div class="variant-group" id="unlimited-variants" style="display: none;">
            {% for variant in product.variants %}
              {% if variant.sku contains 'daily' or variant.sku contains 'Daily' %}
                <div class="plan-card" data-variant-id="{{ variant.id }}">
                  <input type="radio" 
                         name="variant" 
                         value="{{ variant.id }}"
                         data-price="{{ variant.price | money }}"
                         data-title="{{ variant.title }}">
                  
                  <div class="plan-content">
                    <div class="plan-info">
                      <div class="plan-name">{{ 'product.unlimited_plan' | t }}</div>
                      <div class="plan-validity">
                        {% assign sku_parts = variant.sku | split: "_" %}
                        {% assign days = sku_parts.last %}
                        {{ 'product.gb_per_day_for' | t: days: days }}
                      </div>
                    </div>
                    <div class="plan-price-wrapper">
                      {% if variant.compare_at_price > variant.price %}
                        <span class="plan-price-old">{{ variant.compare_at_price | money }}</span>
                      {% endif %}
                      <span class="plan-price">{{ variant.price | money }}</span>
                    </div>
                  </div>
                </div>
              {% endif %}
            {% endfor %}
          </div>
        {% endif %}
      </div>
      
      <!-- Purchase Box - DESKTOP ONLY -->
      <div class="purchase-box">
        <h3 class="purchase-title">{{ 'product.your_selection' | t }}</h3>
        
        <div class="summary-box">
          <div class="summary-row">
            <span class="summary-label">{{ product.title }} eSIM</span>
            <span class="summary-value" id="selected-variant">-</span>
          </div>
          <div class="summary-row">
            <span class="summary-label">{{ 'product.network' | t }}</span>
            <span class="summary-value">{{ product.metafields.custom.plantyp | default: '4G/5G' }}</span>
          </div>
          <div class="summary-row">
            <span class="summary-label">{{ 'product.activation' | t }}</span>
            <span class="summary-value">{{ 'product.instant' | t }}</span>
          </div>
          <div class="summary-row">
            <span class="summary-label">{{ 'product.total' | t }}</span>
            <span class="summary-value" id="total-price">-</span>
          </div>
        </div>
        
        <form action="/cart/add?return_to=/checkout" method="post" class="checkout-form" id="product-form">
          <input type="hidden" name="id" id="variant-input" value="">
          <button type="submit" class="checkout-button">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17M17 13v8m0-8L17 21m0 0a2 2 0 11-4 0 2 2 0 014 0zm-10 0a2 2 0 11-4 0 2 2 0 014 0z"/>
            </svg>
            <span>{{ 'product.buy_now' | t }}</span>
          </button>
        </form>
        
        <div class="payment-methods">
          {% assign payment_types = 'visa,master,apple_pay,google_pay,paypal' | split: ',' %}
          {% for type in payment_types %}
            {{ type | payment_type_svg_tag: class: 'payment-method' }}
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  
  <!-- Product Details Section - NEW -->
  <div class="product-details">
    <div class="details-tabs">
      <button class="details-tab active" data-tab="description">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M13 16h-1v-4h1m0-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <span>{{ 'product.description' | t }}</span>
      </button>
      <button class="details-tab" data-tab="specs">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
          <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
        </svg>
        <span>{{ 'product.technical_details' | t }}</span>
      </button>
    </div>
    
    <div class="details-content">
      <!-- Description Panel -->
      <div class="details-panel active" id="description-panel">
        <div class="description-features">
          <h2 class="description-title">
            {{ 'product.why_choose' | t: product: product.title }}
          </h2>
          
          <div class="feature-list">
            <div class="feature-item">
              <div class="feature-icon-wrapper">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
              </div>
              <div class="feature-content">
                <strong>{{ 'product.feature_lowdata_title' | t }}</strong>
                <p>{{ 'product.feature_lowdata_desc' | t }}</p>
              </div>
            </div>
            
            <div class="feature-item">
              <div class="feature-icon-wrapper">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"/>
                </svg>
              </div>
              <div class="feature-content">
                <strong>{{ 'product.feature_nosim_title' | t }}</strong>
                <p>{{ 'product.feature_nosim_desc' | t }}</p>
              </div>
            </div>
            
            <div class="feature-item">
              <div class="feature-icon-wrapper">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path d="M8.288 15.038a5.25 5.25 0 017.424 0M5.106 11.856c3.807-3.808 9.98-3.808 13.788 0M1.924 8.674c5.565-5.565 14.587-5.565 20.152 0M12.53 18.22l-.53.53-.53-.53a.75.75 0 011.06 0z"/>
                </svg>
              </div>
              <div class="feature-content">
                <strong>{{ 'product.feature_network_title' | t }}</strong>
                <p>{{ 'product.feature_network_desc' | t }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Technical Specs Panel -->
      <div class="details-panel" id="specs-panel">
        <div class="specs-grid">
          <div class="spec-item">
            <span class="spec-label">{{ 'product.spec_network' | t }}:</span>
            <span class="spec-value">{{ product.metafields.custom.plantyp | default: '4G/5G' }}</span>
          </div>
          <div class="spec-item">
            <span class="spec-label">{{ 'product.spec_speed' | t }}:</span>
            <span class="spec-value">4G/5G</span>
          </div>
          <div class="spec-item">
            <span class="spec-label">{{ 'product.spec_coverage' | t }}:</span>
            <span class="spec-value">98%</span>
          </div>
          <div class="spec-item">
            <span class="spec-label">{{ 'product.spec_plans' | t }}:</span>
            <span class="spec-value">
              {% assign datalist = "" %}
              {% for variant in product.variants %}
                {% assign value = variant.metafields.custom.data_ | replace: " ", "" %}
                {% unless value == "100MB" %}
                  {% if datalist == "" %}
                    {% assign datalist = value %}
                  {% else %}
                    {% assign datalist = datalist | append: ", " | append: value %}
                  {% endif %}
                {% endunless %}
              {% endfor %}
              {{ datalist | default: "1GB - 50GB" }}
            </span>
          </div>
          <div class="spec-item">
            <span class="spec-label">{{ 'product.spec_validity' | t }}:</span>
            <span class="spec-value">7-30 {{ 'product.days' | t }}</span>
          </div>
          <div class="spec-item">
            <span class="spec-label">{{ 'product.spec_hotspot' | t }}:</span>
            <span class="spec-value">‚úì</span>
          </div>
          <div class="spec-item">
            <span class="spec-label">{{ 'product.spec_voice' | t }}:</span>
            <span class="spec-value">{{ 'product.spec_voice_apps' | t }}</span>
          </div>
          <div class="spec-item">
            <span class="spec-label">{{ 'product.spec_plantype' | t }}:</span>
            <span class="spec-value">Prepaid eSIM</span>
          </div>
          <div class="spec-item">
            <span class="spec-label">{{ 'product.spec_ekyc' | t }}:</span>
            <span class="spec-value">‚úó</span>
          </div>
          <div class="spec-item">
            <span class="spec-label">{{ 'product.spec_delivery' | t }}:</span>
            <span class="spec-value">{{ 'product.instant' | t }}</span>
          </div>
          <div class="spec-item">
            <span class="spec-label">{{ 'product.spec_phone' | t }}:</span>
            <span class="spec-value">‚úó</span>
          </div>
          <div class="spec-item">
            <span class="spec-label">{{ 'product.spec_esim_validity' | t }}:</span>
            <span class="spec-value">180 {{ 'product.days' | t }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Features Section -->
  <div class="features-section">
    <h2 class="features-title">{{ 'product.why_choose' | t: product: product.title }}</h2>
    
    <div class="features-grid">
      <div class="feature-card">
        <div class="feature-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
          </svg>
        </div>
        <h3 class="feature-name">{{ 'product.feature_instant_title' | t }}</h3>
        <p class="feature-desc">{{ 'product.feature_instant_desc' | t }}</p>
      </div>
      
      <div class="feature-card">
        <div class="feature-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <h3 class="feature-name">{{ 'product.feature_network_title' | t }}</h3>
        <p class="feature-desc">{{ 'product.feature_network_desc' | t }}</p>
      </div>
      
      <div class="feature-card">
        <div class="feature-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z"/>
          </svg>
        </div>
        <h3 class="feature-name">{{ 'product.feature_support_title' | t }}</h3>
        <p class="feature-desc">{{ 'product.feature_support_desc' | t }}</p>
      </div>
    </div>
  </div>
  
  <!-- Mobile Sticky Cart -->
  <div class="mobile-sticky" id="mobile-sticky">
    <div class="sticky-container">
      <div class="sticky-info">
        <div class="sticky-title" id="sticky-title">-</div>
        <div class="sticky-price" id="sticky-price">-</div>
      </div>
      <button class="sticky-button" id="sticky-button">{{ 'product.buy_now' | t }}</button>
    </div>
  </div>
</section>

<script>
(function() {
  'use strict';
  
  // Elements
  const section = document.querySelector('.product-enterprise');
  const variantTabs = section.querySelectorAll('.variant-tab');
  const detailsTabs = section.querySelectorAll('.details-tab');
  const normalGroup = section.querySelector('#normal-variants');
  const unlimitedGroup = section.querySelector('#unlimited-variants');
  const fairUseNotice = section.querySelector('#fair-use-notice');
  const planCards = section.querySelectorAll('.plan-card');
  const variantInput = section.querySelector('#variant-input');
  const selectedVariantText = section.querySelector('#selected-variant');
  const totalPriceText = section.querySelector('#total-price');
  const productForm = section.querySelector('#product-form');
  
  // Mobile Sticky
  const mobileSticky = section.querySelector('#mobile-sticky');
  const stickyTitle = section.querySelector('#sticky-title');
  const stickyPrice = section.querySelector('#sticky-price');
  const stickyButton = section.querySelector('#sticky-button');
  
  // State
  let currentVariant = null;
  let isCustomerLoggedIn = {{ customer.id | default: 'null' }} !== null;
  let hasPurchasedFreeVariant = false;
  
  // Check if customer has purchased free variant
  if (isCustomerLoggedIn) {
    const purchasedFree = getCookie('purchased_free_esim');
    if (purchasedFree === 'true') {
      hasPurchasedFreeVariant = true;
    }
  }
  
  // Variant Tab Switching
  if (variantTabs.length > 0) {
    variantTabs.forEach(tab => {
      tab.addEventListener('click', function() {
        variantTabs.forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        
        const tabType = this.dataset.tab;
        
        if (tabType === 'unlimited') {
          if (normalGroup) normalGroup.style.display = 'none';
          if (unlimitedGroup) unlimitedGroup.style.display = 'block';
          if (fairUseNotice) fairUseNotice.classList.add('active');
        } else {
          if (normalGroup) normalGroup.style.display = 'block';
          if (unlimitedGroup) unlimitedGroup.style.display = 'none';
          if (fairUseNotice) fairUseNotice.classList.remove('active');
        }
        
        // Select first variant in active tab
        const activeGroup = tabType === 'unlimited' ? unlimitedGroup : normalGroup;
        const firstCard = activeGroup?.querySelector('.plan-card');
        if (firstCard) {
          selectPlan(firstCard);
        }
      });
    });
  }
  
  // Details Tab Switching
  detailsTabs.forEach(tab => {
    tab.addEventListener('click', function() {
      const targetTab = this.dataset.tab;
      
      // Update tabs
      detailsTabs.forEach(t => t.classList.remove('active'));
      this.classList.add('active');
      
      // Update panels
      section.querySelectorAll('.details-panel').forEach(panel => {
        panel.classList.remove('active');
      });
      section.querySelector(`#${targetTab}-panel`)?.classList.add('active');
    });
  });
  
  // Plan Selection
  function selectPlan(card) {
    // Remove selected from all
    planCards.forEach(c => c.classList.remove('selected'));
    
    // Add selected to clicked
    card.classList.add('selected');
    
    // Get radio input
    const radio = card.querySelector('input[type="radio"]');
    if (radio) {
      radio.checked = true;
      currentVariant = {
        id: radio.value,
        price: radio.dataset.price,
        title: radio.dataset.title
      };
      
      // Update UI
      variantInput.value = currentVariant.id;
      selectedVariantText.textContent = currentVariant.title;
      totalPriceText.textContent = currentVariant.price;
      
      // Update sticky
      if (mobileSticky) {
        stickyTitle.textContent = currentVariant.title;
        stickyPrice.textContent = currentVariant.price;
      }
    }
  }
  
  // Add click listeners to plan cards
  planCards.forEach(card => {
    card.addEventListener('click', function(e) {
      // Check if it's a free variant and user not logged in
      const isFree = this.dataset.isFree === 'true';
      
      if (isFree && !isCustomerLoggedIn) {
        e.preventDefault();
        // Don't select, let them click login
        return;
      }
      
      if (isFree && hasPurchasedFreeVariant) {
        e.preventDefault();
        alert('{{ "product.already_purchased_free" | t }}');
        return;
      }
      
      selectPlan(this);
    });
  });
  
  // Form submission
  productForm.addEventListener('submit', function(e) {
    if (!currentVariant) {
      e.preventDefault();
      alert('{{ "product.select_variant" | t }}');
      return;
    }
    
    // Set Free eSIM cookie if applicable
    const selectedCard = section.querySelector('.plan-card.selected');
    if (selectedCard?.dataset.isFree === 'true') {
      setCookie('purchased_free_esim', 'true', 365);
    }
  });
  
  // Mobile Sticky Cart on Scroll
  let ticking = false;
  window.addEventListener('scroll', function() {
    if (!ticking) {
      window.requestAnimationFrame(function() {
        const selectionTop = section.querySelector('.product-selection')?.offsetTop || 0;
        const scrolled = window.scrollY > selectionTop + 100;
        
        if (mobileSticky) {
          mobileSticky.classList.toggle('active', scrolled);
        }
        
        ticking = false;
      });
      ticking = true;
    }
  });
  
  // Sticky button click
  if (stickyButton) {
    stickyButton.addEventListener('click', function() {
      productForm.dispatchEvent(new Event('submit'));
    });
  }
  
  // Helper Functions
  function setCookie(name, value, days) {
    const date = new Date();
    date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
    document.cookie = name + '=' + value + '; expires=' + date.toUTCString() + '; path=/';
  }
  
  function getCookie(name) {
    const nameEQ = name + '=';
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      let c = cookies[i].trim();
      if (c.indexOf(nameEQ) === 0) {
        return c.substring(nameEQ.length);
      }
    }
    return null;
  }
  
  // Initialize - Select first variant
  const firstCard = section.querySelector('.plan-card');
  if (firstCard) {
    selectPlan(firstCard);
  }
})();
</script>

{% schema %}
{
  "name": "Product Enterprise V4",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_features",
      "label": "Show Features Section",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_sticky_mobile",
      "label": "Enable Mobile Sticky Cart",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_direct_checkout",
      "label": "Skip Cart (Direct to Checkout)",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Product Enterprise V4"
    }
  ]
}
{% endschema %}